<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RAW Labour Hire - Admin Dashboard</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
            background-color: #F3F4F6;
            min-height: 100vh;
        }
        
        .header {
            background-color: #1E3A8A;
            color: white;
            padding: 16px 40px;
            display: flex;
            align-items: center;
            gap: 20px;
        }
        
        .header img {
            height: 60px;
            object-fit: contain;
        }
        
        .header-text h1 {
            font-size: 24px;
            font-weight: 600;
        }
        
        .header-text .subtitle {
            font-size: 14px;
            opacity: 0.8;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 30px;
        }
        
        /* Main navigation tabs */
        .main-nav {
            display: flex;
            gap: 4px;
            margin-bottom: 30px;
            background: white;
            padding: 8px;
            border-radius: 12px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }
        
        .main-nav-tab {
            padding: 12px 28px;
            border: none;
            background: none;
            font-size: 15px;
            font-weight: 600;
            color: #6B7280;
            cursor: pointer;
            border-radius: 8px;
            transition: all 0.2s;
        }
        
        .main-nav-tab:hover {
            background: #F3F4F6;
            color: #1E3A8A;
        }
        
        .main-nav-tab.active {
            background: #1E3A8A;
            color: white;
        }
        
        .main-nav-tab .badge {
            background: rgba(255,255,255,0.2);
            padding: 2px 8px;
            border-radius: 10px;
            font-size: 12px;
            margin-left: 8px;
        }
        
        .main-nav-tab:not(.active) .badge {
            background: #E5E7EB;
            color: #6B7280;
        }
        
        .main-section {
            display: none;
        }
        
        .main-section.active {
            display: block;
        }
        
        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .stat-card {
            background: white;
            border-radius: 12px;
            padding: 24px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }
        
        .stat-card .label {
            font-size: 14px;
            color: #6B7280;
            margin-bottom: 8px;
        }
        
        .stat-card .value {
            font-size: 32px;
            font-weight: 700;
            color: #1E3A8A;
        }
        
        .stat-card.pending .value {
            color: #F59E0B;
        }
        
        .stat-card.approved .value {
            color: #10B981;
        }
        
        .tabs {
            display: flex;
            gap: 8px;
            margin-bottom: 20px;
            border-bottom: 2px solid #E5E7EB;
            padding-bottom: 0;
        }
        
        .tab {
            padding: 12px 24px;
            border: none;
            background: none;
            font-size: 15px;
            font-weight: 500;
            color: #6B7280;
            cursor: pointer;
            border-bottom: 3px solid transparent;
            margin-bottom: -2px;
            transition: all 0.2s;
        }
        
        .tab:hover {
            color: #1E3A8A;
        }
        
        .tab.active {
            color: #1E3A8A;
            border-bottom-color: #1E3A8A;
        }
        
        .tab .count {
            background: #E5E7EB;
            padding: 2px 8px;
            border-radius: 10px;
            font-size: 12px;
            margin-left: 8px;
        }
        
        .tab.active .count {
            background: #1E3A8A;
            color: white;
        }
        
        .section-title {
            font-size: 20px;
            font-weight: 600;
            color: #1F2937;
            margin-bottom: 20px;
        }
        
        .entries-grid {
            display: grid;
            gap: 20px;
        }
        
        .entry-card {
            background: white;
            border-radius: 12px;
            padding: 24px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }
        
        .entry-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 20px;
            flex-wrap: wrap;
            gap: 12px;
        }
        
        .entry-worker {
            flex: 1;
        }
        
        .entry-worker .name {
            font-size: 18px;
            font-weight: 600;
            color: #1F2937;
        }
        
        .entry-worker .email {
            font-size: 14px;
            color: #6B7280;
        }
        
        .entry-badge {
            background: #FEF3C7;
            color: #D97706;
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
        }
        
        .entry-badge.approved, .entry-badge.verified {
            background: #D1FAE5;
            color: #059669;
        }
        
        .entry-badge.rejected {
            background: #FEE2E2;
            color: #DC2626;
        }
        
        .entry-badge.expired {
            background: #FEE2E2;
            color: #DC2626;
        }
        
        .entry-details {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 16px;
            margin-bottom: 20px;
        }
        
        .detail-item {
            padding: 12px;
            background: #F9FAFB;
            border-radius: 8px;
        }
        
        .detail-item .label {
            font-size: 12px;
            color: #6B7280;
            margin-bottom: 4px;
        }
        
        .detail-item .value {
            font-size: 14px;
            font-weight: 500;
            color: #1F2937;
        }
        
        .signature-section {
            border-top: 1px solid #E5E7EB;
            padding-top: 20px;
            margin-top: 20px;
        }
        
        .signature-section h4 {
            font-size: 14px;
            color: #6B7280;
            margin-bottom: 12px;
        }
        
        .signature-image {
            background: white;
            border: 2px solid #E5E7EB;
            border-radius: 8px;
            max-width: 400px;
            max-height: 200px;
        }
        
        .entry-actions {
            display: flex;
            gap: 12px;
            margin-top: 20px;
            padding-top: 20px;
            border-top: 1px solid #E5E7EB;
        }
        
        .btn {
            padding: 12px 24px;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            border: none;
            transition: all 0.2s;
        }
        
        .btn-approve {
            background: #10B981;
            color: white;
        }
        
        .btn-approve:hover {
            background: #059669;
        }
        
        .btn-reject {
            background: #EF4444;
            color: white;
        }
        
        .btn-reject:hover {
            background: #DC2626;
        }
        
        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: #6B7280;
            background: white;
            border-radius: 12px;
        }
        
        .empty-state svg {
            width: 64px;
            height: 64px;
            margin-bottom: 16px;
            opacity: 0.5;
        }
        
        .loading {
            text-align: center;
            padding: 60px 20px;
            color: #6B7280;
        }
        
        .refresh-btn {
            background: #1E3A8A;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            margin-left: auto;
        }
        
        .refresh-btn:hover {
            background: #1E40AF;
        }
        
        .toolbar {
            display: flex;
            align-items: center;
            margin-bottom: 20px;
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
        }
        
        .approved-info {
            font-size: 13px;
            color: #059669;
            margin-top: 8px;
        }
        
        /* Ticket Images */
        .ticket-images {
            display: flex;
            gap: 20px;
            flex-wrap: wrap;
            margin-top: 20px;
            padding-top: 20px;
            border-top: 1px solid #E5E7EB;
        }
        
        .ticket-image-container {
            flex: 1;
            min-width: 200px;
            max-width: 400px;
        }
        
        .ticket-image-container h4 {
            font-size: 14px;
            color: #6B7280;
            margin-bottom: 12px;
        }
        
        .ticket-image {
            width: 100%;
            max-height: 300px;
            object-fit: contain;
            background: #F9FAFB;
            border: 2px solid #E5E7EB;
            border-radius: 8px;
            cursor: pointer;
        }
        
        .ticket-image:hover {
            border-color: #1E3A8A;
        }
        
        /* Modal for full image view */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.8);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }
        
        .modal.active {
            display: flex;
        }
        
        .modal img {
            max-width: 90%;
            max-height: 90%;
            object-fit: contain;
            border-radius: 8px;
        }
        
        .modal-close {
            position: absolute;
            top: 20px;
            right: 30px;
            color: white;
            font-size: 40px;
            cursor: pointer;
        }
    </style>
</head>
<body>
    <div class="header">
        <img src="/admin/raw-logo.png" alt="RAW Labour Hire Logo" />
        <div class="header-text">
            <h1>Admin Dashboard</h1>
            <div class="subtitle">Timesheet & Ticket Management</div>
        </div>
    </div>
    
    <div class="container">
        <!-- Main Navigation -->
        <div class="main-nav">
            <button class="main-nav-tab active" data-section="timesheets" onclick="switchMainSection('timesheets')">
                Timesheets <span class="badge" id="timesheet-badge">0</span>
            </button>
            <button class="main-nav-tab" data-section="tickets" onclick="switchMainSection('tickets')">
                Tickets <span class="badge" id="ticket-badge">0</span>
            </button>
            <button class="main-nav-tab" data-section="inductions" onclick="switchMainSection('inductions')">
                Inductions <span class="badge" id="induction-badge">0</span>
            </button>
            <button class="main-nav-tab" data-section="jobsites" onclick="switchMainSection('jobsites')">
                Job Sites <span class="badge" id="jobsites-badge">0</span>
            </button>
            <button class="main-nav-tab" data-section="clients" onclick="switchMainSection('clients')">
                Clients <span class="badge" id="clients-badge">0</span>
            </button>
            <button class="main-nav-tab" data-section="workers" onclick="switchMainSection('workers')">
                Workers <span class="badge" id="workers-badge">0</span>
            </button>
            <button class="main-nav-tab" data-section="myob" onclick="switchMainSection('myob')">
                MYOB <span class="badge" id="myob-badge" style="background: #10B981; color: white;">Setup</span>
            </button>
        </div>
        
        <!-- TIMESHEETS SECTION -->
        <div id="timesheets-section" class="main-section active">
            <div class="stats">
                <div class="stat-card pending">
                    <div class="label">Pending Approval</div>
                    <div class="value" id="pending-count">-</div>
                </div>
                <div class="stat-card approved">
                    <div class="label">Approved (Total)</div>
                    <div class="value" id="approved-count">-</div>
                </div>
                <div class="stat-card">
                    <div class="label">Pending Hours</div>
                    <div class="value" id="pending-hours">-</div>
                </div>
                <div class="stat-card">
                    <div class="label">Approved Hours</div>
                    <div class="value" id="approved-hours">-</div>
                </div>
            </div>
            
            <div class="tabs">
                <button class="tab active" data-tab="pending" onclick="switchTab('pending')">
                    Pending <span class="count" id="pending-tab-count">0</span>
                </button>
                <button class="tab" data-tab="approved" onclick="switchTab('approved')">
                    Approved <span class="count" id="approved-tab-count">0</span>
                </button>
            </div>
            
            <div class="toolbar">
                <button class="refresh-btn" onclick="loadTimesheetData()">â†» Refresh</button>
            </div>
            
            <div id="pending-content" class="tab-content active">
                <div id="pending-entries" class="entries-grid">
                    <div class="loading">Loading entries...</div>
                </div>
            </div>
            
            <div id="approved-content" class="tab-content">
                <div id="approved-entries" class="entries-grid">
                    <div class="loading">Loading entries...</div>
                </div>
            </div>
        </div>
        
        <!-- TICKETS SECTION -->
        <div id="tickets-section" class="main-section">
            <div class="stats">
                <div class="stat-card pending">
                    <div class="label">Pending Verification</div>
                    <div class="value" id="tickets-pending-count">-</div>
                </div>
                <div class="stat-card approved">
                    <div class="label">Verified</div>
                    <div class="value" id="tickets-verified-count">-</div>
                </div>
                <div class="stat-card">
                    <div class="label">Expired</div>
                    <div class="value" id="tickets-expired-count">-</div>
                </div>
                <div class="stat-card">
                    <div class="label">Total Tickets</div>
                    <div class="value" id="tickets-total-count">-</div>
                </div>
            </div>
            
            <div class="tabs">
                <button class="tab active" data-tab="tickets-pending" onclick="switchTicketTab('tickets-pending')">
                    Pending <span class="count" id="tickets-pending-tab-count">0</span>
                </button>
                <button class="tab" data-tab="tickets-verified" onclick="switchTicketTab('tickets-verified')">
                    Verified <span class="count" id="tickets-verified-tab-count">0</span>
                </button>
                <button class="tab" data-tab="tickets-all" onclick="switchTicketTab('tickets-all')">
                    All <span class="count" id="tickets-all-tab-count">0</span>
                </button>
            </div>
            
            <div class="toolbar">
                <button class="refresh-btn" onclick="loadTicketData()">â†» Refresh</button>
            </div>
            
            <div id="tickets-pending-content" class="tab-content active">
                <div id="tickets-pending-entries" class="entries-grid">
                    <div class="loading">Loading tickets...</div>
                </div>
            </div>
            
            <div id="tickets-verified-content" class="tab-content">
                <div id="tickets-verified-entries" class="entries-grid">
                    <div class="loading">Loading tickets...</div>
                </div>
            </div>
            
            <div id="tickets-all-content" class="tab-content">
                <div id="tickets-all-entries" class="entries-grid">
                    <div class="loading">Loading tickets...</div>
                </div>
            </div>
        </div>
        
        <!-- INDUCTIONS SECTION -->
        <div id="inductions-section" class="main-section">
            <div class="stats">
                <div class="stat-card approved">
                    <div class="label">Fully Inducted</div>
                    <div class="value" id="induction-complete-count">-</div>
                </div>
                <div class="stat-card pending">
                    <div class="label">Incomplete</div>
                    <div class="value" id="induction-incomplete-count">-</div>
                </div>
                <div class="stat-card">
                    <div class="label">Total Workers</div>
                    <div class="value" id="induction-total-count">-</div>
                </div>
                <div class="stat-card">
                    <div class="label">Active Documents</div>
                    <div class="value" id="induction-docs-count">-</div>
                </div>
            </div>
            
            <div class="tabs">
                <button class="tab active" data-tab="induction-workers" onclick="switchInductionTab('induction-workers')">
                    Workers <span class="count" id="induction-workers-tab-count">0</span>
                </button>
                <button class="tab" data-tab="induction-documents" onclick="switchInductionTab('induction-documents')">
                    SWMS Documents <span class="count" id="induction-docs-tab-count">0</span>
                </button>
            </div>
            
            <div class="toolbar">
                <button class="refresh-btn" onclick="loadInductionData()">â†» Refresh</button>
            </div>
            
            <!-- Workers Tab -->
            <div id="induction-workers-content" class="tab-content active">
                <div id="induction-users" class="entries-grid">
                    <div class="loading">Loading induction data...</div>
                </div>
            </div>
            
            <!-- Documents Tab -->
            <div id="induction-documents-content" class="tab-content">
                <!-- Add Document Button -->
                <div style="margin-bottom: 20px;">
                    <button class="btn btn-approve" onclick="showAddDocumentModal()" style="padding: 12px 20px;">
                        + Add New SWMS Document
                    </button>
                </div>
                
                <div id="induction-documents-list" class="entries-grid">
                    <div class="loading">Loading documents...</div>
                </div>
            </div>
        </div>
        
        <!-- JOB SITES SECTION -->
        <div id="jobsites-section" class="main-section">
            <div class="stats">
                <div class="stat-card">
                    <div class="label">Total Job Sites</div>
                    <div class="value" id="jobsites-total-count">-</div>
                </div>
                <div class="stat-card approved">
                    <div class="label">Active Sites</div>
                    <div class="value" id="jobsites-active-count">-</div>
                </div>
            </div>
            
            <div class="toolbar" style="display: flex; justify-content: space-between; align-items: center;">
                <button class="refresh-btn" onclick="loadJobSitesData()">â†» Refresh</button>
                <button class="btn btn-approve" onclick="showAddJobSiteModal()" style="padding: 12px 20px;">
                    + Add New Job Site
                </button>
            </div>
            
            <h3 style="margin: 20px 0 15px; color: #1F2937;">Job Sites</h3>
            
            <div id="jobsites-list" class="entries-grid">
                <div class="loading">Loading job sites...</div>
            </div>
        </div>
        
        <!-- CLIENTS SECTION -->
        <div id="clients-section" class="main-section">
            <div class="stats">
                <div class="stat-card">
                    <div class="label">Total Clients</div>
                    <div class="value" id="clients-total-count">-</div>
                </div>
                <div class="stat-card approved">
                    <div class="label">Active Clients</div>
                    <div class="value" id="clients-active-count">-</div>
                </div>
            </div>
            
            <div class="toolbar" style="display: flex; justify-content: space-between; align-items: center;">
                <button class="refresh-btn" onclick="loadClientsData()">â†» Refresh</button>
                <button class="btn btn-approve" onclick="showAddClientModal()" style="padding: 12px 20px;">
                    + Add New Client
                </button>
            </div>
            
            <h3 style="margin: 20px 0 15px; color: #1F2937;">Clients</h3>
            
            <div id="clients-list" class="entries-grid">
                <div class="loading">Loading clients...</div>
            </div>
        </div>
        
        <!-- Workers Directory Section -->
        <div id="workers-section" class="main-section">
            <div class="stats">
                <div class="stat-card">
                    <div class="label">Total Workers</div>
                    <div class="value" id="workers-total-count">-</div>
                </div>
                <div class="stat-card approved">
                    <div class="label">Active Workers</div>
                    <div class="value" id="workers-active-count">-</div>
                </div>
            </div>
            
            <div class="toolbar" style="display: flex; justify-content: space-between; align-items: center;">
                <button class="refresh-btn" onclick="loadWorkersData()">â†» Refresh</button>
                <button class="btn btn-approve" onclick="showAddWorkerModal()" style="padding: 12px 20px;">
                    + Add New Worker
                </button>
            </div>
            
            <h3 style="margin: 20px 0 15px; color: #1F2937;">Workers Directory</h3>
            
            <div id="workers-list" class="entries-grid">
                <div class="loading">Loading workers...</div>
            </div>
        </div>
        
        <!-- Add/Edit Worker Modal -->
        <div id="add-worker-modal" class="modal" style="justify-content: center; align-items: center;">
            <div style="background: white; border-radius: 16px; width: 95%; max-width: 800px; max-height: 90vh; overflow: hidden; display: flex; flex-direction: column;">
                <div style="padding: 20px; border-bottom: 1px solid #E5E7EB; display: flex; justify-content: space-between; align-items: center;">
                    <h2 id="worker-modal-title" style="font-size: 18px; font-weight: 600; color: #1F2937;">Add New Worker</h2>
                    <button onclick="closeAddWorkerModal()" style="background: none; border: none; font-size: 24px; cursor: pointer; color: #6B7280;">&times;</button>
                </div>
                <div style="padding: 20px; overflow-y: auto;">
                    <input type="hidden" id="worker-edit-id" value="">
                    
                    <!-- Personal Information -->
                    <h4 style="color: #374151; margin-bottom: 12px; padding-bottom: 8px; border-bottom: 1px solid #E5E7EB;">Personal Information</h4>
                    <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 16px; margin-bottom: 24px;">
                        <div>
                            <label style="display: block; font-size: 14px; font-weight: 500; color: #374151; margin-bottom: 6px;">First Name *</label>
                            <input type="text" id="worker-first-name" style="width: 100%; padding: 10px; border: 1px solid #E5E7EB; border-radius: 8px; font-size: 14px;">
                        </div>
                        <div>
                            <label style="display: block; font-size: 14px; font-weight: 500; color: #374151; margin-bottom: 6px;">Surname *</label>
                            <input type="text" id="worker-surname" style="width: 100%; padding: 10px; border: 1px solid #E5E7EB; border-radius: 8px; font-size: 14px;">
                        </div>
                        <div>
                            <label style="display: block; font-size: 14px; font-weight: 500; color: #374151; margin-bottom: 6px;">Email *</label>
                            <input type="email" id="worker-email" style="width: 100%; padding: 10px; border: 1px solid #E5E7EB; border-radius: 8px; font-size: 14px;">
                        </div>
                        <div>
                            <label style="display: block; font-size: 14px; font-weight: 500; color: #374151; margin-bottom: 6px;">Phone</label>
                            <input type="text" id="worker-phone" style="width: 100%; padding: 10px; border: 1px solid #E5E7EB; border-radius: 8px; font-size: 14px;">
                        </div>
                        <div>
                            <label style="display: block; font-size: 14px; font-weight: 500; color: #374151; margin-bottom: 6px;">Date of Birth</label>
                            <input type="date" id="worker-dob" style="width: 100%; padding: 10px; border: 1px solid #E5E7EB; border-radius: 8px; font-size: 14px;">
                        </div>
                        <div>
                            <label style="display: block; font-size: 14px; font-weight: 500; color: #374151; margin-bottom: 6px;">Start Date</label>
                            <input type="date" id="worker-start-date" style="width: 100%; padding: 10px; border: 1px solid #E5E7EB; border-radius: 8px; font-size: 14px;">
                        </div>
                    </div>
                    
                    <!-- Address -->
                    <h4 style="color: #374151; margin-bottom: 12px; padding-bottom: 8px; border-bottom: 1px solid #E5E7EB;">Address</h4>
                    <div style="display: grid; grid-template-columns: 1fr; gap: 16px; margin-bottom: 16px;">
                        <div>
                            <label style="display: block; font-size: 14px; font-weight: 500; color: #374151; margin-bottom: 6px;">Street Address</label>
                            <input type="text" id="worker-address" placeholder="e.g., 123 Main Street" style="width: 100%; padding: 10px; border: 1px solid #E5E7EB; border-radius: 8px; font-size: 14px;">
                        </div>
                    </div>
                    <div style="display: grid; grid-template-columns: 2fr 1fr 1fr; gap: 16px; margin-bottom: 24px;">
                        <div>
                            <label style="display: block; font-size: 14px; font-weight: 500; color: #374151; margin-bottom: 6px;">Suburb</label>
                            <input type="text" id="worker-suburb" style="width: 100%; padding: 10px; border: 1px solid #E5E7EB; border-radius: 8px; font-size: 14px;">
                        </div>
                        <div>
                            <label style="display: block; font-size: 14px; font-weight: 500; color: #374151; margin-bottom: 6px;">State</label>
                            <select id="worker-state" style="width: 100%; padding: 10px; border: 1px solid #E5E7EB; border-radius: 8px; font-size: 14px;">
                                <option value="">Select</option>
                                <option value="VIC">VIC</option>
                                <option value="NSW">NSW</option>
                                <option value="QLD">QLD</option>
                                <option value="SA">SA</option>
                                <option value="WA">WA</option>
                                <option value="TAS">TAS</option>
                                <option value="NT">NT</option>
                                <option value="ACT">ACT</option>
                            </select>
                        </div>
                        <div>
                            <label style="display: block; font-size: 14px; font-weight: 500; color: #374151; margin-bottom: 6px;">Postcode</label>
                            <input type="text" id="worker-postcode" style="width: 100%; padding: 10px; border: 1px solid #E5E7EB; border-radius: 8px; font-size: 14px;">
                        </div>
                    </div>
                    
                    <!-- Emergency Contact -->
                    <h4 style="color: #374151; margin-bottom: 12px; padding-bottom: 8px; border-bottom: 1px solid #E5E7EB;">Emergency Contact / Next of Kin</h4>
                    <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 16px; margin-bottom: 24px;">
                        <div>
                            <label style="display: block; font-size: 14px; font-weight: 500; color: #374151; margin-bottom: 6px;">Contact Name</label>
                            <input type="text" id="worker-emergency-name" style="width: 100%; padding: 10px; border: 1px solid #E5E7EB; border-radius: 8px; font-size: 14px;">
                        </div>
                        <div>
                            <label style="display: block; font-size: 14px; font-weight: 500; color: #374151; margin-bottom: 6px;">Contact Phone</label>
                            <input type="text" id="worker-emergency-phone" style="width: 100%; padding: 10px; border: 1px solid #E5E7EB; border-radius: 8px; font-size: 14px;">
                        </div>
                        <div>
                            <label style="display: block; font-size: 14px; font-weight: 500; color: #374151; margin-bottom: 6px;">Relationship</label>
                            <input type="text" id="worker-emergency-relationship" placeholder="e.g., Spouse, Parent" style="width: 100%; padding: 10px; border: 1px solid #E5E7EB; border-radius: 8px; font-size: 14px;">
                        </div>
                    </div>
                    
                    <!-- Bank Details -->
                    <h4 style="color: #374151; margin-bottom: 12px; padding-bottom: 8px; border-bottom: 1px solid #E5E7EB;">Bank Details for Payment</h4>
                    <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 16px; margin-bottom: 24px;">
                        <div>
                            <label style="display: block; font-size: 14px; font-weight: 500; color: #374151; margin-bottom: 6px;">Account Name</label>
                            <input type="text" id="worker-bank-name" style="width: 100%; padding: 10px; border: 1px solid #E5E7EB; border-radius: 8px; font-size: 14px;">
                        </div>
                        <div>
                            <label style="display: block; font-size: 14px; font-weight: 500; color: #374151; margin-bottom: 6px;">BSB</label>
                            <input type="text" id="worker-bank-bsb" placeholder="e.g., 063-000" style="width: 100%; padding: 10px; border: 1px solid #E5E7EB; border-radius: 8px; font-size: 14px;">
                        </div>
                        <div>
                            <label style="display: block; font-size: 14px; font-weight: 500; color: #374151; margin-bottom: 6px;">Account Number</label>
                            <input type="text" id="worker-bank-account" style="width: 100%; padding: 10px; border: 1px solid #E5E7EB; border-radius: 8px; font-size: 14px;">
                        </div>
                    </div>
                    
                    <!-- Tax & Pay Rates -->
                    <h4 style="color: #374151; margin-bottom: 12px; padding-bottom: 8px; border-bottom: 1px solid #E5E7EB;">Tax & Pay Rates</h4>
                    <div style="display: grid; grid-template-columns: repeat(5, 1fr); gap: 16px; margin-bottom: 24px;">
                        <div>
                            <label style="display: block; font-size: 14px; font-weight: 500; color: #374151; margin-bottom: 6px;">TFN</label>
                            <input type="text" id="worker-tfn" style="width: 100%; padding: 10px; border: 1px solid #E5E7EB; border-radius: 8px; font-size: 14px;">
                        </div>
                        <div>
                            <label style="display: block; font-size: 14px; font-weight: 500; color: #374151; margin-bottom: 6px;">Base Rate $/hr</label>
                            <input type="number" id="worker-base-rate" step="0.01" value="0" style="width: 100%; padding: 10px; border: 1px solid #E5E7EB; border-radius: 8px; font-size: 14px;">
                        </div>
                        <div>
                            <label style="display: block; font-size: 14px; font-weight: 500; color: #374151; margin-bottom: 6px;">Overtime $/hr</label>
                            <input type="number" id="worker-overtime-rate" step="0.01" value="0" style="width: 100%; padding: 10px; border: 1px solid #E5E7EB; border-radius: 8px; font-size: 14px;">
                        </div>
                        <div>
                            <label style="display: block; font-size: 14px; font-weight: 500; color: #374151; margin-bottom: 6px;">Weekend $/hr</label>
                            <input type="number" id="worker-weekend-rate" step="0.01" value="0" style="width: 100%; padding: 10px; border: 1px solid #E5E7EB; border-radius: 8px; font-size: 14px;">
                        </div>
                        <div>
                            <label style="display: block; font-size: 14px; font-weight: 500; color: #374151; margin-bottom: 6px;">Night $/hr</label>
                            <input type="number" id="worker-night-rate" step="0.01" value="0" style="width: 100%; padding: 10px; border: 1px solid #E5E7EB; border-radius: 8px; font-size: 14px;">
                        </div>
                    </div>
                    
                    <!-- Employment Type & Role -->
                    <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 16px; margin-bottom: 16px;">
                        <div>
                            <label style="display: block; font-size: 14px; font-weight: 500; color: #374151; margin-bottom: 6px;">Employment Type</label>
                            <select id="worker-employment-type" style="width: 100%; padding: 10px; border: 1px solid #E5E7EB; border-radius: 8px; font-size: 14px;">
                                <option value="casual">Casual</option>
                                <option value="full_time">Full Time</option>
                                <option value="part_time">Part Time</option>
                            </select>
                        </div>
                        <div>
                            <label style="display: block; font-size: 14px; font-weight: 500; color: #374151; margin-bottom: 6px;">Role</label>
                            <select id="worker-role" style="width: 100%; padding: 10px; border: 1px solid #E5E7EB; border-radius: 8px; font-size: 14px;">
                                <option value="worker">Worker</option>
                                <option value="supervisor">Supervisor</option>
                                <option value="admin">Admin</option>
                            </select>
                        </div>
                    </div>
                </div>
                <div style="padding: 16px 20px; border-top: 1px solid #E5E7EB; display: flex; justify-content: flex-end; gap: 12px;">
                    <button onclick="closeAddWorkerModal()" style="padding: 12px 24px; border-radius: 8px; border: 1px solid #E5E7EB; background: white; font-size: 15px; cursor: pointer;">Cancel</button>
                    <button onclick="saveWorker()" id="save-worker-btn" style="padding: 12px 24px; border-radius: 8px; border: none; background: #10B981; color: white; font-size: 15px; font-weight: 600; cursor: pointer;">Save Worker</button>
                </div>
            </div>
        </div>
        
        <!-- MYOB Integration Section -->
        <div id="myob-section" class="main-section">
            <div class="stats">
                <div class="stat-card">
                    <div class="label">Connection Status</div>
                    <div class="value" id="myob-status" style="font-size: 18px;">Checking...</div>
                </div>
                <div class="stat-card">
                    <div class="label">Company File</div>
                    <div class="value" id="myob-company" style="font-size: 16px;">-</div>
                </div>
                <div class="stat-card approved">
                    <div class="label">Ready to Export</div>
                    <div class="value" id="myob-ready-count">0</div>
                </div>
            </div>
            
            <!-- MYOB Setup Section -->
            <div id="myob-setup-section" style="background: white; border-radius: 12px; padding: 24px; margin-bottom: 24px; box-shadow: 0 1px 3px rgba(0,0,0,0.1);">
                <h3 style="margin-bottom: 16px; color: #1F2937;">MYOB Setup</h3>
                
                <div id="myob-not-connected" style="display: none;">
                    <p style="color: #6B7280; margin-bottom: 16px;">Connect your MYOB Business account to export approved timesheets for invoicing and payroll.</p>
                    
                    <div style="margin-bottom: 16px;">
                        <label style="display: block; font-size: 14px; font-weight: 500; color: #374151; margin-bottom: 6px;">MYOB Client ID</label>
                        <input type="text" id="myob-client-id" placeholder="Enter your MYOB API Client ID" style="width: 100%; max-width: 500px; padding: 12px; border: 1px solid #E5E7EB; border-radius: 8px; font-size: 14px;">
                    </div>
                    
                    <div style="margin-bottom: 16px;">
                        <label style="display: block; font-size: 14px; font-weight: 500; color: #374151; margin-bottom: 6px;">MYOB Client Secret</label>
                        <input type="password" id="myob-client-secret" placeholder="Enter your MYOB API Client Secret" style="width: 100%; max-width: 500px; padding: 12px; border: 1px solid #E5E7EB; border-radius: 8px; font-size: 14px;">
                    </div>
                    
                    <button onclick="saveMYOBCredentials()" class="btn btn-approve" style="padding: 12px 24px; margin-right: 12px;">Save Credentials</button>
                    <button onclick="connectMYOB()" class="btn" style="padding: 12px 24px; background: #1E3A8A; color: white;">Connect to MYOB</button>
                    
                    <p style="margin-top: 16px; font-size: 13px; color: #9CA3AF;">
                        Don't have API credentials? <a href="https://developer.myob.com/" target="_blank" style="color: #1E3A8A;">Register at MYOB Developer Portal</a>
                    </p>
                </div>
                
                <div id="myob-connected" style="display: none;">
                    <div style="display: flex; align-items: center; gap: 12px; margin-bottom: 16px;">
                        <span style="color: #10B981; font-size: 24px;">âœ“</span>
                        <span style="color: #10B981; font-weight: 600;">Connected to MYOB Business</span>
                    </div>
                    <p id="myob-connected-company" style="color: #6B7280; margin-bottom: 16px;">Company: Loading...</p>
                    <button onclick="disconnectMYOB()" class="btn btn-reject" style="padding: 10px 20px;">Disconnect</button>
                </div>
            </div>
            
            <!-- Sub-tabs for MYOB -->
            <div class="tabs" style="margin-bottom: 20px;">
                <button class="tab active" data-myob-tab="export" onclick="switchMYOBTab('export')">Export to MYOB</button>
                <button class="tab" data-myob-tab="workers" onclick="switchMYOBTab('workers')">Worker Pay Rates</button>
                <button class="tab" data-myob-tab="clients" onclick="switchMYOBTab('clients')">Client Billing Rates</button>
                <button class="tab" data-myob-tab="history" onclick="switchMYOBTab('history')">Export History</button>
            </div>
            
            <!-- Export Tab -->
            <div id="myob-export-tab" class="myob-tab-content">
                <div style="background: white; border-radius: 12px; padding: 24px; box-shadow: 0 1px 3px rgba(0,0,0,0.1);">
                    <!-- CSV Export Section -->
                    <div style="background: #F0FDF4; border: 1px solid #86EFAC; border-radius: 8px; padding: 16px; margin-bottom: 20px;">
                        <h4 style="color: #166534; margin-bottom: 12px;">CSV Export (No API Required)</h4>
                        <p style="color: #15803D; font-size: 14px; margin-bottom: 12px;">Download approved timesheets as CSV files for manual import into MYOB.</p>
                        <div style="display: flex; gap: 12px; flex-wrap: wrap;">
                            <button onclick="downloadCSV('invoices')" class="btn" style="padding: 10px 16px; background: #166534; color: white;">
                                ðŸ“„ Download Invoices CSV
                            </button>
                            <button onclick="downloadCSV('payroll')" class="btn" style="padding: 10px 16px; background: #166534; color: white;">
                                ðŸ“„ Download Payroll CSV
                            </button>
                            <button onclick="downloadCSV('timesheets')" class="btn" style="padding: 10px 16px; background: #166534; color: white;">
                                ðŸ“„ Download Full Timesheets CSV
                            </button>
                        </div>
                    </div>
                    
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                        <h3 style="color: #1F2937;">Approved Entries Ready for Export</h3>
                        <div>
                            <label style="margin-right: 16px;">
                                <input type="checkbox" id="export-invoices" checked> Create Invoices
                            </label>
                            <label style="margin-right: 16px;">
                                <input type="checkbox" id="export-payroll" checked> Create Payroll Entries
                            </label>
                            <button onclick="exportSelectedToMYOB()" class="btn btn-approve" style="padding: 10px 20px;">
                                Export to MYOB API
                            </button>
                        </div>
                    </div>
                    
                    <table style="width: 100%; border-collapse: collapse;">
                        <thead>
                            <tr style="border-bottom: 2px solid #E5E7EB;">
                                <th style="text-align: left; padding: 12px 8px; font-size: 13px; color: #6B7280;">
                                    <input type="checkbox" id="select-all-entries" onchange="toggleSelectAll()">
                                </th>
                                <th style="text-align: left; padding: 12px 8px; font-size: 13px; color: #6B7280;">Date</th>
                                <th style="text-align: left; padding: 12px 8px; font-size: 13px; color: #6B7280;">Worker</th>
                                <th style="text-align: left; padding: 12px 8px; font-size: 13px; color: #6B7280;">Client</th>
                                <th style="text-align: left; padding: 12px 8px; font-size: 13px; color: #6B7280;">Site</th>
                                <th style="text-align: right; padding: 12px 8px; font-size: 13px; color: #6B7280;">Hours</th>
                                <th style="text-align: center; padding: 12px 8px; font-size: 13px; color: #6B7280;">Status</th>
                            </tr>
                        </thead>
                        <tbody id="myob-entries-list">
                            <tr><td colspan="7" style="padding: 20px; text-align: center; color: #6B7280;">Loading...</td></tr>
                        </tbody>
                    </table>
                </div>
            </div>
            
            <!-- Worker Pay Rates Tab -->
            <div id="myob-workers-tab" class="myob-tab-content" style="display: none;">
                <div style="background: white; border-radius: 12px; padding: 24px; box-shadow: 0 1px 3px rgba(0,0,0,0.1);">
                    <h3 style="color: #1F2937; margin-bottom: 20px;">Worker Pay Rates</h3>
                    <p style="color: #6B7280; margin-bottom: 20px;">Set hourly pay rates for each worker. These rates are used for payroll exports.</p>
                    
                    <div id="workers-rates-list">
                        <div class="loading">Loading workers...</div>
                    </div>
                </div>
            </div>
            
            <!-- Client Billing Rates Tab -->
            <div id="myob-clients-tab" class="myob-tab-content" style="display: none;">
                <div style="background: white; border-radius: 12px; padding: 24px; box-shadow: 0 1px 3px rgba(0,0,0,0.1);">
                    <h3 style="color: #1F2937; margin-bottom: 20px;">Client Billing Rates</h3>
                    <p style="color: #6B7280; margin-bottom: 20px;">Set hourly billing rates for each client. These rates are used for invoice exports.</p>
                    
                    <div id="clients-rates-list">
                        <div class="loading">Loading clients...</div>
                    </div>
                </div>
            </div>
            
            <!-- Export History Tab -->
            <div id="myob-history-tab" class="myob-tab-content" style="display: none;">
                <div style="background: white; border-radius: 12px; padding: 24px; box-shadow: 0 1px 3px rgba(0,0,0,0.1);">
                    <h3 style="color: #1F2937; margin-bottom: 20px;">Export History</h3>
                    
                    <table style="width: 100%; border-collapse: collapse;">
                        <thead>
                            <tr style="border-bottom: 2px solid #E5E7EB;">
                                <th style="text-align: left; padding: 12px 8px; font-size: 13px; color: #6B7280;">Date</th>
                                <th style="text-align: left; padding: 12px 8px; font-size: 13px; color: #6B7280;">Type</th>
                                <th style="text-align: right; padding: 12px 8px; font-size: 13px; color: #6B7280;">Amount</th>
                                <th style="text-align: center; padding: 12px 8px; font-size: 13px; color: #6B7280;">Status</th>
                            </tr>
                        </thead>
                        <tbody id="myob-history-list">
                            <tr><td colspan="4" style="padding: 20px; text-align: center; color: #6B7280;">Loading...</td></tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
        
        <!-- Add/Edit Client Modal -->
        <div id="add-client-modal" class="modal" style="justify-content: center; align-items: center;">
            <div style="background: white; border-radius: 16px; width: 90%; max-width: 600px; max-height: 90vh; overflow: hidden; display: flex; flex-direction: column;">
                <div style="padding: 20px; border-bottom: 1px solid #E5E7EB; display: flex; justify-content: space-between; align-items: center;">
                    <h2 id="client-modal-title" style="font-size: 18px; font-weight: 600; color: #1F2937;">Add New Client</h2>
                    <button onclick="closeAddClientModal()" style="background: none; border: none; font-size: 24px; cursor: pointer; color: #6B7280;">&times;</button>
                </div>
                <div style="padding: 20px; overflow-y: auto; flex: 1;">
                    <input type="hidden" id="client-edit-id" value="">
                    <div style="margin-bottom: 16px;">
                        <label style="display: block; font-size: 14px; font-weight: 500; color: #374151; margin-bottom: 6px;">Company Name *</label>
                        <input type="text" id="client-name" placeholder="e.g., ABC Construction Pty Ltd" style="width: 100%; padding: 12px; border: 1px solid #E5E7EB; border-radius: 8px; font-size: 15px;">
                    </div>
                    <div style="margin-bottom: 16px;">
                        <label style="display: block; font-size: 14px; font-weight: 500; color: #374151; margin-bottom: 6px;">Contact Name</label>
                        <input type="text" id="client-contact-name" placeholder="e.g., John Smith" style="width: 100%; padding: 12px; border: 1px solid #E5E7EB; border-radius: 8px; font-size: 15px;">
                    </div>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px; margin-bottom: 16px;">
                        <div>
                            <label style="display: block; font-size: 14px; font-weight: 500; color: #374151; margin-bottom: 6px;">Contact Email</label>
                            <input type="email" id="client-email" placeholder="john@company.com" style="width: 100%; padding: 12px; border: 1px solid #E5E7EB; border-radius: 8px; font-size: 15px;">
                        </div>
                        <div>
                            <label style="display: block; font-size: 14px; font-weight: 500; color: #374151; margin-bottom: 6px;">Contact Phone</label>
                            <input type="tel" id="client-phone" placeholder="0412 345 678" style="width: 100%; padding: 12px; border: 1px solid #E5E7EB; border-radius: 8px; font-size: 15px;">
                        </div>
                    </div>
                    <div style="margin-bottom: 16px;">
                        <label style="display: block; font-size: 14px; font-weight: 500; color: #374151; margin-bottom: 6px;">Address</label>
                        <input type="text" id="client-address" placeholder="123 Business St, Melbourne VIC 3000" style="width: 100%; padding: 12px; border: 1px solid #E5E7EB; border-radius: 8px; font-size: 15px;">
                    </div>
                </div>
                <div style="padding: 20px; border-top: 1px solid #E5E7EB; display: flex; gap: 12px; justify-content: flex-end;">
                    <button onclick="closeAddClientModal()" style="padding: 12px 24px; border-radius: 8px; border: 1px solid #E5E7EB; background: white; color: #374151; font-size: 15px; font-weight: 500; cursor: pointer;">Cancel</button>
                    <button onclick="saveClient()" id="save-client-btn" style="padding: 12px 24px; border-radius: 8px; border: none; background: #10B981; color: white; font-size: 15px; font-weight: 600; cursor: pointer;">Save Client</button>
                </div>
            </div>
        </div>
        
        <!-- Add/Edit Job Site Modal -->
        <div id="add-jobsite-modal" class="modal" style="justify-content: center; align-items: center;">
            <div style="background: white; border-radius: 16px; width: 90%; max-width: 600px; max-height: 90vh; overflow: hidden; display: flex; flex-direction: column;">
                <div style="padding: 20px; border-bottom: 1px solid #E5E7EB; display: flex; justify-content: space-between; align-items: center;">
                    <h2 id="jobsite-modal-title" style="font-size: 18px; font-weight: 600; color: #1F2937;">Add New Job Site</h2>
                    <button onclick="closeAddJobSiteModal()" style="background: none; border: none; font-size: 24px; cursor: pointer; color: #6B7280;">&times;</button>
                </div>
                <div style="padding: 20px; overflow-y: auto; flex: 1;">
                    <input type="hidden" id="jobsite-edit-id" value="">
                    <div style="margin-bottom: 16px;">
                        <label style="display: block; font-size: 14px; font-weight: 500; color: #374151; margin-bottom: 6px;">Site Name *</label>
                        <input type="text" id="jobsite-name" placeholder="e.g., Melbourne CBD Office, Warehouse A" style="width: 100%; padding: 12px; border: 1px solid #E5E7EB; border-radius: 8px; font-size: 15px;">
                    </div>
                    <div style="margin-bottom: 16px;">
                        <label style="display: block; font-size: 14px; font-weight: 500; color: #374151; margin-bottom: 6px;">Address *</label>
                        <input type="text" id="jobsite-address" placeholder="e.g., 123 Collins St, Melbourne VIC 3000" style="width: 100%; padding: 12px; border: 1px solid #E5E7EB; border-radius: 8px; font-size: 15px;">
                    </div>
                    <div style="margin-bottom: 16px;">
                        <label style="display: block; font-size: 14px; font-weight: 500; color: #374151; margin-bottom: 6px;">Client (Optional)</label>
                        <select id="jobsite-client" style="width: 100%; padding: 12px; border: 1px solid #E5E7EB; border-radius: 8px; font-size: 15px;">
                            <option value="">Select a client...</option>
                        </select>
                    </div>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px; margin-bottom: 16px;">
                        <div>
                            <label style="display: block; font-size: 14px; font-weight: 500; color: #374151; margin-bottom: 6px;">Site Contact Name</label>
                            <input type="text" id="jobsite-contact-name" placeholder="e.g., John Smith" style="width: 100%; padding: 12px; border: 1px solid #E5E7EB; border-radius: 8px; font-size: 15px;">
                        </div>
                        <div>
                            <label style="display: block; font-size: 14px; font-weight: 500; color: #374151; margin-bottom: 6px;">Site Contact Phone</label>
                            <input type="tel" id="jobsite-contact-phone" placeholder="e.g., 0412 345 678" style="width: 100%; padding: 12px; border: 1px solid #E5E7EB; border-radius: 8px; font-size: 15px;">
                        </div>
                    </div>
                </div>
                <div style="padding: 20px; border-top: 1px solid #E5E7EB; display: flex; gap: 12px; justify-content: flex-end;">
                    <button onclick="closeAddJobSiteModal()" style="padding: 12px 24px; border-radius: 8px; border: 1px solid #E5E7EB; background: white; color: #374151; font-size: 15px; font-weight: 500; cursor: pointer;">Cancel</button>
                    <button onclick="saveJobSite()" id="save-jobsite-btn" style="padding: 12px 24px; border-radius: 8px; border: none; background: #10B981; color: white; font-size: 15px; font-weight: 600; cursor: pointer;">Save Job Site</button>
                </div>
            </div>
        </div>
        
        <!-- Add Document Modal -->
        <div id="add-document-modal" class="modal" style="justify-content: center; align-items: center;">
            <div style="background: white; border-radius: 16px; width: 90%; max-width: 800px; max-height: 90vh; overflow: hidden; display: flex; flex-direction: column;">
                <div style="padding: 20px; border-bottom: 1px solid #E5E7EB; display: flex; justify-content: space-between; align-items: center;">
                    <h2 style="font-size: 18px; font-weight: 600; color: #1F2937;">Add New SWMS Document</h2>
                    <button onclick="closeAddDocumentModal()" style="background: none; border: none; font-size: 24px; cursor: pointer; color: #6B7280;">&times;</button>
                </div>
                <div style="padding: 20px; overflow-y: auto; flex: 1;">
                    <div style="margin-bottom: 16px;">
                        <label style="display: block; font-size: 14px; font-weight: 500; color: #374151; margin-bottom: 6px;">Title *</label>
                        <input type="text" id="doc-title" placeholder="e.g., Electrical Safety SWMS" style="width: 100%; padding: 12px; border: 1px solid #E5E7EB; border-radius: 8px; font-size: 15px;">
                    </div>
                    <div style="margin-bottom: 16px;">
                        <label style="display: block; font-size: 14px; font-weight: 500; color: #374151; margin-bottom: 6px;">Description</label>
                        <input type="text" id="doc-description" placeholder="Brief description of the document" style="width: 100%; padding: 12px; border: 1px solid #E5E7EB; border-radius: 8px; font-size: 15px;">
                    </div>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px; margin-bottom: 16px;">
                        <div>
                            <label style="display: block; font-size: 14px; font-weight: 500; color: #374151; margin-bottom: 6px;">Type</label>
                            <select id="doc-type" style="width: 100%; padding: 12px; border: 1px solid #E5E7EB; border-radius: 8px; font-size: 15px;">
                                <option value="swms">SWMS</option>
                                <option value="induction">Induction</option>
                                <option value="policy">Policy</option>
                            </select>
                        </div>
                        <div>
                            <label style="display: block; font-size: 14px; font-weight: 500; color: #374151; margin-bottom: 6px;">Category</label>
                            <input type="text" id="doc-category" placeholder="e.g., Safety, Manual Handling" style="width: 100%; padding: 12px; border: 1px solid #E5E7EB; border-radius: 8px; font-size: 15px;">
                        </div>
                    </div>
                    <div style="margin-bottom: 16px;">
                        <label style="display: flex; align-items: center; gap: 8px; font-size: 14px; color: #374151; cursor: pointer;">
                            <input type="checkbox" id="doc-required" checked style="width: 18px; height: 18px;">
                            Required for all workers (must be signed during onboarding)
                        </label>
                    </div>
                    
                    <!-- Content Type Toggle -->
                    <div style="margin-bottom: 16px;">
                        <label style="display: block; font-size: 14px; font-weight: 500; color: #374151; margin-bottom: 10px;">Document Source *</label>
                        <div style="display: flex; gap: 12px;">
                            <label style="display: flex; align-items: center; gap: 8px; padding: 12px 20px; border: 2px solid #10B981; border-radius: 8px; cursor: pointer; background: #ECFDF5;" id="content-type-text-label">
                                <input type="radio" name="content-type" value="text" checked onchange="toggleContentType('text')" style="width: 18px; height: 18px;">
                                <span style="font-weight: 500;">Type Content</span>
                            </label>
                            <label style="display: flex; align-items: center; gap: 8px; padding: 12px 20px; border: 2px solid #E5E7EB; border-radius: 8px; cursor: pointer;" id="content-type-pdf-label">
                                <input type="radio" name="content-type" value="pdf" onchange="toggleContentType('pdf')" style="width: 18px; height: 18px;">
                                <span style="font-weight: 500;">Upload PDF</span>
                            </label>
                        </div>
                    </div>
                    
                    <!-- Text Content Section -->
                    <div id="text-content-section" style="margin-bottom: 16px;">
                        <label style="display: block; font-size: 14px; font-weight: 500; color: #374151; margin-bottom: 6px;">Content</label>
                        <p style="font-size: 12px; color: #6B7280; margin-bottom: 8px;">You can use basic HTML tags: &lt;h2&gt;, &lt;h3&gt;, &lt;p&gt;, &lt;ul&gt;, &lt;li&gt;, &lt;strong&gt;</p>
                        <textarea id="doc-content" rows="15" placeholder="Enter the document content here..." style="width: 100%; padding: 12px; border: 1px solid #E5E7EB; border-radius: 8px; font-size: 14px; font-family: monospace; resize: vertical;"></textarea>
                    </div>
                    
                    <!-- PDF Upload Section -->
                    <div id="pdf-upload-section" style="margin-bottom: 16px; display: none;">
                        <label style="display: block; font-size: 14px; font-weight: 500; color: #374151; margin-bottom: 6px;">Upload PDF File</label>
                        <div id="pdf-dropzone" style="border: 2px dashed #D1D5DB; border-radius: 12px; padding: 40px 20px; text-align: center; cursor: pointer; transition: all 0.2s;" onclick="document.getElementById('pdf-file-input').click()">
                            <div id="pdf-dropzone-content">
                                <svg xmlns="http://www.w3.org/2000/svg" style="width: 48px; height: 48px; margin: 0 auto 12px; color: #9CA3AF;" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12" />
                                </svg>
                                <p style="font-size: 15px; color: #374151; margin-bottom: 4px;">Click to upload or drag and drop</p>
                                <p style="font-size: 13px; color: #6B7280;">PDF files only (max 10MB)</p>
                            </div>
                            <div id="pdf-file-preview" style="display: none;">
                                <svg xmlns="http://www.w3.org/2000/svg" style="width: 48px; height: 48px; margin: 0 auto 12px; color: #DC2626;" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
                                </svg>
                                <p id="pdf-filename" style="font-size: 15px; font-weight: 500; color: #374151;"></p>
                                <button onclick="event.stopPropagation(); clearPdfFile();" style="margin-top: 8px; padding: 6px 16px; background: #FEE2E2; color: #DC2626; border: none; border-radius: 6px; cursor: pointer; font-size: 13px;">Remove</button>
                            </div>
                        </div>
                        <input type="file" id="pdf-file-input" accept=".pdf" style="display: none;" onchange="handlePdfFileSelect(event)">
                    </div>
                </div>
                <div style="padding: 20px; border-top: 1px solid #E5E7EB; display: flex; gap: 12px; justify-content: flex-end;">
                    <button onclick="closeAddDocumentModal()" style="padding: 12px 24px; border-radius: 8px; border: 1px solid #E5E7EB; background: white; color: #374151; font-size: 15px; font-weight: 500; cursor: pointer;">Cancel</button>
                    <button onclick="createDocument()" id="create-doc-btn" style="padding: 12px 24px; border-radius: 8px; border: none; background: #10B981; color: white; font-size: 15px; font-weight: 600; cursor: pointer;">Create Document</button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Image Modal -->
    <div id="image-modal" class="modal" onclick="closeImageModal()">
        <span class="modal-close">&times;</span>
        <img id="modal-image" src="" alt="Ticket Image" />
    </div>
    
    <script>
        const API_BASE = window.location.origin + '/api';
        let allTickets = [];
        
        // ========== MAIN SECTION SWITCHING ==========
        function switchMainSection(section) {
            // Update nav buttons
            document.querySelectorAll('.main-nav-tab').forEach(t => t.classList.remove('active'));
            document.querySelector(`.main-nav-tab[data-section="${section}"]`).classList.add('active');
            
            // Update sections
            document.querySelectorAll('.main-section').forEach(s => s.classList.remove('active'));
            document.getElementById(`${section}-section`).classList.add('active');
            
            // Reset sub-tabs to first tab
            if (section === 'timesheets') {
                switchTab('pending');
            } else if (section === 'tickets') {
                switchTicketTab('tickets-pending');
            } else if (section === 'inductions') {
                loadInductionData();
            } else if (section === 'jobsites') {
                loadJobSitesData();
            } else if (section === 'clients') {
                loadClientsData();
            } else if (section === 'workers') {
                loadWorkersData();
            } else if (section === 'myob') {
                loadMYOBData();
            }
        }
        
        // ========== TIMESHEET TAB SWITCHING ==========
        function switchTab(tab) {
            // Update tab buttons in timesheets section only
            document.querySelectorAll('#timesheets-section .tab').forEach(t => t.classList.remove('active'));
            document.querySelector(`#timesheets-section .tab[data-tab="${tab}"]`).classList.add('active');
            
            // Update tab content
            document.querySelectorAll('#timesheets-section .tab-content').forEach(c => c.classList.remove('active'));
            document.getElementById(`${tab}-content`).classList.add('active');
        }
        
        // ========== TICKET TAB SWITCHING ==========
        function switchTicketTab(tab) {
            // Update tab buttons in tickets section only
            document.querySelectorAll('#tickets-section .tab').forEach(t => t.classList.remove('active'));
            document.querySelector(`#tickets-section .tab[data-tab="${tab}"]`).classList.add('active');
            
            // Update tab content
            document.querySelectorAll('#tickets-section .tab-content').forEach(c => c.classList.remove('active'));
            document.getElementById(`${tab}-content`).classList.add('active');
        }
        
        // ========== LOAD ALL DATA ==========
        async function loadAllData() {
            await Promise.all([loadTimesheetData(), loadTicketData(), loadInductionData()]);
        }
        
        async function loadTimesheetData() {
            await Promise.all([loadPendingEntries(), loadApprovedEntries()]);
        }
        
        // ========== TIMESHEET LOADING ==========
        async function loadPendingEntries() {
            const container = document.getElementById('pending-entries');
            container.innerHTML = '<div class="loading">Loading entries...</div>';
            
            try {
                const response = await fetch(`${API_BASE}/timesheets/admin/pending-entries`);
                const data = await response.json();
                
                document.getElementById('pending-count').textContent = data.entries.length;
                document.getElementById('pending-tab-count').textContent = data.entries.length;
                document.getElementById('timesheet-badge').textContent = data.entries.length;
                
                const totalHours = data.entries.reduce((sum, e) => sum + (e.total_hours || 0), 0);
                document.getElementById('pending-hours').textContent = totalHours.toFixed(1) + 'h';
                
                if (data.entries.length === 0) {
                    container.innerHTML = `
                        <div class="empty-state">
                            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" />
                            </svg>
                            <h3>All caught up!</h3>
                            <p>No pending entries to approve</p>
                        </div>
                    `;
                    return;
                }
                
                container.innerHTML = data.entries.map(entry => renderEntryCard(entry, true)).join('');
                
            } catch (error) {
                console.error('Error loading entries:', error);
                container.innerHTML = `
                    <div class="empty-state">
                        <h3>Error loading entries</h3>
                        <p>${error.message}</p>
                        <button class="refresh-btn" onclick="loadPendingEntries()" style="margin-top: 20px;">Try Again</button>
                    </div>
                `;
            }
        }
        
        async function loadApprovedEntries() {
            const container = document.getElementById('approved-entries');
            container.innerHTML = '<div class="loading">Loading entries...</div>';
            
            try {
                const response = await fetch(`${API_BASE}/timesheets/admin/approved-entries`);
                const data = await response.json();
                
                document.getElementById('approved-count').textContent = data.entries.length;
                document.getElementById('approved-tab-count').textContent = data.entries.length;
                
                const totalHours = data.entries.reduce((sum, e) => sum + (e.total_hours || 0), 0);
                document.getElementById('approved-hours').textContent = totalHours.toFixed(1) + 'h';
                
                if (data.entries.length === 0) {
                    container.innerHTML = `
                        <div class="empty-state">
                            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20 13V6a2 2 0 00-2-2H6a2 2 0 00-2 2v7m16 0v5a2 2 0 01-2 2H6a2 2 0 01-2-2v-5m16 0h-2.586a1 1 0 00-.707.293l-2.414 2.414a1 1 0 01-.707.293h-3.172a1 1 0 01-.707-.293l-2.414-2.414A1 1 0 006.586 13H4" />
                            </svg>
                            <h3>No approved entries yet</h3>
                            <p>Approved entries will appear here</p>
                        </div>
                    `;
                    return;
                }
                
                container.innerHTML = data.entries.map(entry => renderEntryCard(entry, false)).join('');
                
            } catch (error) {
                console.error('Error loading entries:', error);
                container.innerHTML = `
                    <div class="empty-state">
                        <h3>Error loading entries</h3>
                        <p>${error.message}</p>
                        <button class="refresh-btn" onclick="loadApprovedEntries()" style="margin-top: 20px;">Try Again</button>
                    </div>
                `;
            }
        }
        
        function renderEntryCard(entry, showActions) {
            return `
                <div class="entry-card" id="entry-${entry.id}">
                    <div class="entry-header">
                        <div class="entry-worker">
                            <div class="name">${entry.worker_name}</div>
                            <div class="email">${entry.worker_email || ''}</div>
                        </div>
                        <div class="entry-badge ${showActions ? '' : 'approved'}">${showActions ? 'Pending Approval' : 'Approved âœ“'}</div>
                    </div>
                    
                    <div class="entry-details">
                        <div class="detail-item">
                            <div class="label">Docket #</div>
                            <div class="value">${entry.docket_number || '-'}</div>
                        </div>
                        <div class="detail-item">
                            <div class="label">Date</div>
                            <div class="value">${entry.day_of_week}, ${formatDate(entry.entry_date)}</div>
                        </div>
                        <div class="detail-item">
                            <div class="label">Time</div>
                            <div class="value">${formatTime(entry.clock_in_time)} - ${formatTime(entry.clock_out_time)}</div>
                        </div>
                        <div class="detail-item">
                            <div class="label">Hours</div>
                            <div class="value">${formatHours(entry.total_hours)}</div>
                        </div>
                        <div class="detail-item">
                            <div class="label">Worked As</div>
                            <div class="value">${entry.worked_as || '-'}</div>
                        </div>
                        <div class="detail-item">
                            <div class="label">Host Company</div>
                            <div class="value">${entry.host_company_name || '-'}</div>
                        </div>
                        <div class="detail-item">
                            <div class="label">Supervisor</div>
                            <div class="value">${entry.supervisor_name || '-'}</div>
                        </div>
                        <div class="detail-item">
                            <div class="label">Supervisor Contact</div>
                            <div class="value">${entry.supervisor_contact || '-'}</div>
                        </div>
                        <div class="detail-item">
                            <div class="label">Location</div>
                            <div class="value">${entry.clock_in_address || '-'}</div>
                        </div>
                        <div class="detail-item">
                            <div class="label">Submitted</div>
                            <div class="value">${formatDateTime(entry.submitted_at)}</div>
                        </div>
                    </div>
                    
                    ${entry.supervisor_signature ? `
                        <div class="signature-section">
                            <h4>Supervisor Signature</h4>
                            <img src="${entry.supervisor_signature}" alt="Supervisor Signature" class="signature-image" />
                        </div>
                    ` : ''}
                    
                    ${showActions ? `
                        <div class="entry-actions">
                            <button class="btn btn-approve" onclick="approveEntry(${entry.id})">âœ“ Approve</button>
                            <button class="btn btn-reject" onclick="rejectEntry(${entry.id})">âœ• Reject</button>
                        </div>
                    ` : ''}
                </div>
            `;
        }
        
        async function approveEntry(entryId) {
            if (!confirm('Approve this timesheet entry?')) return;
            
            try {
                const response = await fetch(`${API_BASE}/timesheets/admin/entries/${entryId}/approve`, {
                    method: 'POST'
                });
                
                if (response.ok) {
                    const card = document.getElementById(`entry-${entryId}`);
                    const badge = card.querySelector('.entry-badge');
                    badge.className = 'entry-badge approved';
                    badge.textContent = 'Approved âœ“';
                    
                    const actions = card.querySelector('.entry-actions');
                    actions.innerHTML = '<span style="color: #059669; font-weight: 600;">âœ“ Entry Approved</span>';
                    
                    setTimeout(loadTimesheetData, 1500);
                } else {
                    alert('Failed to approve entry');
                }
            } catch (error) {
                alert('Error: ' + error.message);
            }
        }
        
        async function rejectEntry(entryId) {
            if (!confirm('Reject this timesheet entry?')) return;
            
            try {
                const response = await fetch(`${API_BASE}/timesheets/admin/entries/${entryId}/reject`, {
                    method: 'POST'
                });
                
                if (response.ok) {
                    const card = document.getElementById(`entry-${entryId}`);
                    const badge = card.querySelector('.entry-badge');
                    badge.className = 'entry-badge rejected';
                    badge.textContent = 'Rejected';
                    
                    const actions = card.querySelector('.entry-actions');
                    actions.innerHTML = '<span style="color: #DC2626; font-weight: 600;">âœ• Entry Rejected</span>';
                    
                    setTimeout(loadTimesheetData, 1500);
                } else {
                    alert('Failed to reject entry');
                }
            } catch (error) {
                alert('Error: ' + error.message);
            }
        }
        
        // ========== TICKET LOADING ==========
        async function loadTicketData() {
            try {
                const response = await fetch(`${API_BASE}/tickets/admin/all`);
                const data = await response.json();
                allTickets = data.tickets || [];
                
                // Calculate counts
                const pendingTickets = allTickets.filter(t => t.status === 'pending');
                const verifiedTickets = allTickets.filter(t => t.status === 'verified');
                const expiredTickets = allTickets.filter(t => t.is_expired || t.status === 'expired');
                
                // Update stats
                document.getElementById('tickets-pending-count').textContent = pendingTickets.length;
                document.getElementById('tickets-verified-count').textContent = verifiedTickets.length;
                document.getElementById('tickets-expired-count').textContent = expiredTickets.length;
                document.getElementById('tickets-total-count').textContent = allTickets.length;
                
                // Update tab counts
                document.getElementById('tickets-pending-tab-count').textContent = pendingTickets.length;
                document.getElementById('tickets-verified-tab-count').textContent = verifiedTickets.length;
                document.getElementById('tickets-all-tab-count').textContent = allTickets.length;
                document.getElementById('ticket-badge').textContent = pendingTickets.length;
                
                // Render lists
                renderTicketList('tickets-pending-entries', pendingTickets, true);
                renderTicketList('tickets-verified-entries', verifiedTickets, false);
                renderTicketList('tickets-all-entries', allTickets, null);
                
            } catch (error) {
                console.error('Error loading tickets:', error);
                ['tickets-pending-entries', 'tickets-verified-entries', 'tickets-all-entries'].forEach(id => {
                    document.getElementById(id).innerHTML = `
                        <div class="empty-state">
                            <h3>Error loading tickets</h3>
                            <p>${error.message}</p>
                            <button class="refresh-btn" onclick="loadTicketData()" style="margin-top: 20px;">Try Again</button>
                        </div>
                    `;
                });
            }
        }
        
        function renderTicketList(containerId, tickets, showActions) {
            const container = document.getElementById(containerId);
            
            if (tickets.length === 0) {
                const emptyMessage = containerId.includes('pending') ? 'No pending tickets to verify' :
                                    containerId.includes('verified') ? 'No verified tickets yet' :
                                    'No tickets uploaded yet';
                container.innerHTML = `
                    <div class="empty-state">
                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 10h18M7 15h1m4 0h1m-7 4h12a3 3 0 003-3V8a3 3 0 00-3-3H6a3 3 0 00-3 3v8a3 3 0 003 3z" />
                        </svg>
                        <h3>${emptyMessage}</h3>
                    </div>
                `;
                return;
            }
            
            container.innerHTML = tickets.map(ticket => renderTicketCard(ticket, showActions)).join('');
        }
        
        function renderTicketCard(ticket, showActions) {
            const statusClass = ticket.status === 'verified' ? 'verified' : 
                               ticket.status === 'rejected' ? 'rejected' : 
                               ticket.is_expired ? 'expired' : '';
            const statusText = ticket.status === 'verified' ? 'Verified âœ“' : 
                              ticket.status === 'rejected' ? 'Rejected' : 
                              ticket.is_expired ? 'Expired' : 'Pending Verification';
            
            return `
                <div class="entry-card" id="ticket-${ticket.id}">
                    <div class="entry-header">
                        <div class="entry-worker">
                            <div class="name">${ticket.user_name}</div>
                            <div class="email">${ticket.user_email || ''}</div>
                        </div>
                        <div class="entry-badge ${statusClass}">${statusText}</div>
                    </div>
                    
                    <div class="entry-details">
                        <div class="detail-item">
                            <div class="label">Ticket Type</div>
                            <div class="value">${ticket.ticket_type_name}</div>
                        </div>
                        <div class="detail-item">
                            <div class="label">Ticket Number</div>
                            <div class="value">${ticket.ticket_number || '-'}</div>
                        </div>
                        <div class="detail-item">
                            <div class="label">Issue Date</div>
                            <div class="value">${ticket.issue_date ? formatDate(ticket.issue_date) : '-'}</div>
                        </div>
                        <div class="detail-item">
                            <div class="label">Expiry Date</div>
                            <div class="value" style="${ticket.is_expired ? 'color: #DC2626; font-weight: 600;' : ''}">${ticket.expiry_date ? formatDate(ticket.expiry_date) : 'No Expiry'}</div>
                        </div>
                        <div class="detail-item">
                            <div class="label">Uploaded</div>
                            <div class="value">${formatDateTime(ticket.created_at)}</div>
                        </div>
                    </div>
                    
                    ${ticket.front_image || ticket.back_image ? `
                        <div class="ticket-images">
                            ${ticket.front_image ? `
                                <div class="ticket-image-container">
                                    <h4>Front of Ticket</h4>
                                    <img src="${ticket.front_image}" alt="Front of ticket" class="ticket-image" onclick="openImageModal('${ticket.front_image.replace(/'/g, "\\'")}')" />
                                </div>
                            ` : ''}
                            ${ticket.back_image ? `
                                <div class="ticket-image-container">
                                    <h4>Back of Ticket</h4>
                                    <img src="${ticket.back_image}" alt="Back of ticket" class="ticket-image" onclick="openImageModal('${ticket.back_image.replace(/'/g, "\\'")}')" />
                                </div>
                            ` : ''}
                        </div>
                    ` : ''}
                    
                    ${showActions === true ? `
                        <div class="entry-actions">
                            <button class="btn btn-approve" onclick="verifyTicket(${ticket.id})">âœ“ Verify</button>
                            <button class="btn btn-reject" onclick="rejectTicket(${ticket.id})">âœ• Reject</button>
                        </div>
                    ` : showActions === false ? '' : `
                        <div class="entry-actions">
                            ${ticket.status === 'pending' ? `
                                <button class="btn btn-approve" onclick="verifyTicket(${ticket.id})">âœ“ Verify</button>
                                <button class="btn btn-reject" onclick="rejectTicket(${ticket.id})">âœ• Reject</button>
                            ` : `
                                <span style="color: ${ticket.status === 'verified' ? '#059669' : '#DC2626'}; font-weight: 600;">
                                    ${ticket.status === 'verified' ? 'âœ“ Verified' : 'âœ• Rejected'}
                                </span>
                            `}
                        </div>
                    `}
                </div>
            `;
        }
        
        async function verifyTicket(ticketId) {
            if (!confirm('Verify this ticket?')) return;
            
            try {
                const response = await fetch(`${API_BASE}/tickets/admin/${ticketId}/verify`, {
                    method: 'POST'
                });
                
                if (response.ok) {
                    const card = document.getElementById(`ticket-${ticketId}`);
                    const badge = card.querySelector('.entry-badge');
                    badge.className = 'entry-badge verified';
                    badge.textContent = 'Verified âœ“';
                    
                    const actions = card.querySelector('.entry-actions');
                    actions.innerHTML = '<span style="color: #059669; font-weight: 600;">âœ“ Ticket Verified</span>';
                    
                    setTimeout(loadTicketData, 1500);
                } else {
                    alert('Failed to verify ticket');
                }
            } catch (error) {
                alert('Error: ' + error.message);
            }
        }
        
        async function rejectTicket(ticketId) {
            if (!confirm('Reject this ticket?')) return;
            
            try {
                const response = await fetch(`${API_BASE}/tickets/admin/${ticketId}/reject`, {
                    method: 'POST'
                });
                
                if (response.ok) {
                    const card = document.getElementById(`ticket-${ticketId}`);
                    const badge = card.querySelector('.entry-badge');
                    badge.className = 'entry-badge rejected';
                    badge.textContent = 'Rejected';
                    
                    const actions = card.querySelector('.entry-actions');
                    actions.innerHTML = '<span style="color: #DC2626; font-weight: 600;">âœ• Ticket Rejected</span>';
                    
                    setTimeout(loadTicketData, 1500);
                } else {
                    alert('Failed to reject ticket');
                }
            } catch (error) {
                alert('Error: ' + error.message);
            }
        }
        
        // ========== INDUCTION TAB SWITCHING ==========
        function switchInductionTab(tab) {
            document.querySelectorAll('#inductions-section .tab').forEach(t => t.classList.remove('active'));
            document.querySelector(`#inductions-section .tab[data-tab="${tab}"]`).classList.add('active');
            
            document.querySelectorAll('#inductions-section .tab-content').forEach(c => c.classList.remove('active'));
            document.getElementById(`${tab}-content`).classList.add('active');
        }
        
        // ========== INDUCTION LOADING ==========
        let allInductionDocs = [];
        
        async function loadInductionData() {
            const usersContainer = document.getElementById('induction-users');
            const docsContainer = document.getElementById('induction-documents-list');
            usersContainer.innerHTML = '<div class="loading">Loading induction data...</div>';
            docsContainer.innerHTML = '<div class="loading">Loading documents...</div>';
            
            try {
                // Load users and documents in parallel
                const [usersResponse, docsResponse] = await Promise.all([
                    fetch(`${API_BASE}/induction/admin/all-status`),
                    fetch(`${API_BASE}/induction/documents`)
                ]);
                
                const usersData = await usersResponse.json();
                const docsData = await docsResponse.json();
                
                const users = usersData.users || [];
                allInductionDocs = docsData.documents || [];
                
                // Calculate stats
                const complete = users.filter(u => u.is_complete).length;
                const incomplete = users.filter(u => !u.is_complete).length;
                
                // Update stats
                document.getElementById('induction-complete-count').textContent = complete;
                document.getElementById('induction-incomplete-count').textContent = incomplete;
                document.getElementById('induction-total-count').textContent = users.length;
                document.getElementById('induction-docs-count').textContent = allInductionDocs.length;
                document.getElementById('induction-badge').textContent = incomplete;
                
                // Update tab counts
                document.getElementById('induction-workers-tab-count').textContent = users.length;
                document.getElementById('induction-docs-tab-count').textContent = allInductionDocs.length;
                
                // Render users
                if (users.length === 0) {
                    usersContainer.innerHTML = `
                        <div class="empty-state">
                            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4.5 1.253v13C19.832 18.477 18.247 18 16.5 18c-1.746 0-3.332.477-4.5 1.253" />
                            </svg>
                            <h3>No workers yet</h3>
                            <p>Worker induction status will appear here</p>
                        </div>
                    `;
                } else {
                    usersContainer.innerHTML = users.map(user => renderInductionCard(user)).join('');
                }
                
                // Render documents
                if (allInductionDocs.length === 0) {
                    docsContainer.innerHTML = `
                        <div class="empty-state">
                            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
                            </svg>
                            <h3>No documents yet</h3>
                            <p>Add SWMS documents using the button above</p>
                        </div>
                    `;
                } else {
                    docsContainer.innerHTML = allInductionDocs.map(doc => renderDocumentCard(doc)).join('');
                }
                
            } catch (error) {
                console.error('Error loading induction data:', error);
                usersContainer.innerHTML = `
                    <div class="empty-state">
                        <h3>Error loading induction data</h3>
                        <p>${error.message}</p>
                        <button class="refresh-btn" onclick="loadInductionData()" style="margin-top: 20px;">Try Again</button>
                    </div>
                `;
            }
        }
        
        function renderInductionCard(user) {
            const progressPercent = user.completion_percentage || 0;
            const isComplete = user.is_complete;
            
            return `
                <div class="entry-card">
                    <div class="entry-header">
                        <div class="entry-worker">
                            <div class="name">${user.user_name}</div>
                            <div class="email">${user.user_email || ''}</div>
                        </div>
                        <div class="entry-badge ${isComplete ? 'verified' : ''}">${isComplete ? 'Complete âœ“' : `${progressPercent}% Complete`}</div>
                    </div>
                    
                    <div style="margin-top: 16px;">
                        <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
                            <span style="font-size: 13px; color: #6B7280;">Progress</span>
                            <span style="font-size: 13px; font-weight: 600; color: ${isComplete ? '#10B981' : '#F59E0B'};">${user.total_signed} / ${user.total_required} documents</span>
                        </div>
                        <div style="height: 8px; background: #E5E7EB; border-radius: 4px; overflow: hidden;">
                            <div style="height: 100%; width: ${progressPercent}%; background: ${isComplete ? '#10B981' : '#F59E0B'}; transition: width 0.3s;"></div>
                        </div>
                    </div>
                </div>
            `;
        }
        
        function renderDocumentCard(doc) {
            const typeColors = {
                swms: { bg: '#FEF3C7', text: '#D97706' },
                induction: { bg: '#DBEAFE', text: '#1D4ED8' },
                policy: { bg: '#E0E7FF', text: '#4338CA' }
            };
            const colors = typeColors[doc.document_type] || typeColors.swms;
            const isPdf = !!doc.pdf_filename;
            
            return `
                <div class="entry-card">
                    <div class="entry-header">
                        <div class="entry-worker">
                            <div class="name" style="display: flex; align-items: center; gap: 8px;">
                                ${doc.title}
                                ${isPdf ? '<span style="padding: 2px 8px; border-radius: 4px; font-size: 10px; font-weight: 600; background: #DC2626; color: white;">PDF</span>' : ''}
                            </div>
                            <div class="email">${doc.description || ''}</div>
                        </div>
                        <div style="display: flex; gap: 8px; align-items: center;">
                            <div style="padding: 4px 10px; border-radius: 12px; font-size: 11px; font-weight: 600; background: ${colors.bg}; color: ${colors.text}; text-transform: uppercase;">
                                ${doc.document_type}
                            </div>
                            ${doc.is_required ? '<div style="padding: 4px 10px; border-radius: 12px; font-size: 11px; font-weight: 600; background: #FEE2E2; color: #DC2626;">Required</div>' : ''}
                        </div>
                    </div>
                    
                    <div class="entry-details" style="margin-top: 12px;">
                        <div class="detail-item">
                            <div class="label">Category</div>
                            <div class="value">${doc.category || '-'}</div>
                        </div>
                        <div class="detail-item">
                            <div class="label">Format</div>
                            <div class="value">${isPdf ? 'PDF Document' : 'Text Content'}</div>
                        </div>
                    </div>
                    
                    <div class="entry-actions" style="justify-content: flex-end;">
                        <button class="btn" style="background: #F3F4F6; color: #374151;" onclick="previewDocument(${doc.id})">${isPdf ? 'View PDF' : 'Preview'}</button>
                        <button class="btn btn-reject" onclick="deactivateDocument(${doc.id})">Deactivate</button>
                    </div>
                </div>
            `;
        }
        
        function previewDocument(docId) {
            const doc = allInductionDocs.find(d => d.id === docId);
            if (!doc) return;
            
            // Handle PDF documents - open in new tab
            if (doc.pdf_filename) {
                window.open(`${API_BASE}/induction/pdf/${doc.pdf_filename}`, '_blank');
                return;
            }
            
            // Create preview modal for text content
            const modal = document.createElement('div');
            modal.className = 'modal active';
            modal.style.cssText = 'justify-content: center; align-items: center;';
            modal.onclick = (e) => { if (e.target === modal) modal.remove(); };
            modal.innerHTML = `
                <div style="background: white; border-radius: 16px; width: 90%; max-width: 800px; max-height: 90vh; overflow: hidden; display: flex; flex-direction: column;">
                    <div style="padding: 20px; border-bottom: 1px solid #E5E7EB; display: flex; justify-content: space-between; align-items: center;">
                        <h2 style="font-size: 18px; font-weight: 600; color: #1F2937;">${doc.title}</h2>
                        <button onclick="this.closest('.modal').remove()" style="background: none; border: none; font-size: 24px; cursor: pointer; color: #6B7280;">&times;</button>
                    </div>
                    <div style="padding: 20px; overflow-y: auto; flex: 1;">
                        <div style="font-size: 14px; line-height: 1.6; color: #374151;">
                            ${doc.content || '<p style="color: #6B7280; text-align: center;">No content available</p>'}
                        </div>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);
        }
        
        async function deactivateDocument(docId) {
            if (!confirm('Are you sure you want to deactivate this document? Workers will no longer need to sign it.')) return;
            
            try {
                const response = await fetch(`${API_BASE}/induction/admin/documents/${docId}`, {
                    method: 'DELETE'
                });
                
                if (response.ok) {
                    loadInductionData();
                } else {
                    alert('Failed to deactivate document');
                }
            } catch (error) {
                alert('Error: ' + error.message);
            }
        }
        
        // ========== ADD DOCUMENT MODAL ==========
        let selectedPdfFile = null;
        let contentType = 'text';
        
        function showAddDocumentModal() {
            document.getElementById('add-document-modal').classList.add('active');
            document.getElementById('doc-title').value = '';
            document.getElementById('doc-description').value = '';
            document.getElementById('doc-type').value = 'swms';
            document.getElementById('doc-category').value = '';
            document.getElementById('doc-required').checked = true;
            document.getElementById('doc-content').value = '';
            clearPdfFile();
            toggleContentType('text');
        }
        
        function closeAddDocumentModal() {
            document.getElementById('add-document-modal').classList.remove('active');
        }
        
        function toggleContentType(type) {
            contentType = type;
            const textSection = document.getElementById('text-content-section');
            const pdfSection = document.getElementById('pdf-upload-section');
            const textLabel = document.getElementById('content-type-text-label');
            const pdfLabel = document.getElementById('content-type-pdf-label');
            
            if (type === 'text') {
                textSection.style.display = 'block';
                pdfSection.style.display = 'none';
                textLabel.style.borderColor = '#10B981';
                textLabel.style.background = '#ECFDF5';
                pdfLabel.style.borderColor = '#E5E7EB';
                pdfLabel.style.background = 'white';
            } else {
                textSection.style.display = 'none';
                pdfSection.style.display = 'block';
                textLabel.style.borderColor = '#E5E7EB';
                textLabel.style.background = 'white';
                pdfLabel.style.borderColor = '#10B981';
                pdfLabel.style.background = '#ECFDF5';
            }
        }
        
        function handlePdfFileSelect(event) {
            const file = event.target.files[0];
            if (file) {
                if (!file.name.toLowerCase().endsWith('.pdf')) {
                    alert('Only PDF files are allowed');
                    return;
                }
                if (file.size > 10 * 1024 * 1024) {
                    alert('File size must be less than 10MB');
                    return;
                }
                selectedPdfFile = file;
                document.getElementById('pdf-dropzone-content').style.display = 'none';
                document.getElementById('pdf-file-preview').style.display = 'block';
                document.getElementById('pdf-filename').textContent = file.name;
            }
        }
        
        function clearPdfFile() {
            selectedPdfFile = null;
            document.getElementById('pdf-file-input').value = '';
            document.getElementById('pdf-dropzone-content').style.display = 'block';
            document.getElementById('pdf-file-preview').style.display = 'none';
        }
        
        // Drag and drop handling
        document.addEventListener('DOMContentLoaded', function() {
            const dropzone = document.getElementById('pdf-dropzone');
            if (dropzone) {
                dropzone.addEventListener('dragover', (e) => {
                    e.preventDefault();
                    dropzone.style.borderColor = '#10B981';
                    dropzone.style.background = '#ECFDF5';
                });
                dropzone.addEventListener('dragleave', () => {
                    dropzone.style.borderColor = '#D1D5DB';
                    dropzone.style.background = 'white';
                });
                dropzone.addEventListener('drop', (e) => {
                    e.preventDefault();
                    dropzone.style.borderColor = '#D1D5DB';
                    dropzone.style.background = 'white';
                    const files = e.dataTransfer.files;
                    if (files.length > 0) {
                        const input = document.getElementById('pdf-file-input');
                        input.files = files;
                        handlePdfFileSelect({ target: input });
                    }
                });
            }
        });
        
        async function createDocument() {
            const title = document.getElementById('doc-title').value.trim();
            const description = document.getElementById('doc-description').value.trim();
            const docType = document.getElementById('doc-type').value;
            const category = document.getElementById('doc-category').value.trim();
            const isRequired = document.getElementById('doc-required').checked;
            
            if (!title) {
                alert('Please enter a title');
                return;
            }
            
            const btn = document.getElementById('create-doc-btn');
            btn.disabled = true;
            btn.textContent = 'Creating...';
            
            try {
                let response;
                
                if (contentType === 'pdf') {
                    // Upload PDF file
                    if (!selectedPdfFile) {
                        alert('Please select a PDF file');
                        btn.disabled = false;
                        btn.textContent = 'Create Document';
                        return;
                    }
                    
                    const formData = new FormData();
                    formData.append('title', title);
                    formData.append('pdf_file', selectedPdfFile);
                    formData.append('document_type', docType);
                    formData.append('is_required', isRequired);
                    if (description) formData.append('description', description);
                    if (category) formData.append('category', category);
                    
                    response = await fetch(`${API_BASE}/induction/admin/documents/upload-pdf`, {
                        method: 'POST',
                        body: formData
                    });
                } else {
                    // Create text document
                    const content = document.getElementById('doc-content').value.trim();
                    if (!content) {
                        alert('Please enter document content');
                        btn.disabled = false;
                        btn.textContent = 'Create Document';
                        return;
                    }
                    
                    const params = new URLSearchParams({
                        title: title,
                        content: content,
                        document_type: docType,
                        is_required: isRequired
                    });
                    if (description) params.append('description', description);
                    if (category) params.append('category', category);
                    
                    response = await fetch(`${API_BASE}/induction/admin/documents?${params.toString()}`, {
                        method: 'POST'
                    });
                }
                
                if (response.ok) {
                    closeAddDocumentModal();
                    loadInductionData();
                    alert('Document created successfully! It will now appear in the mobile app for all workers.');
                } else {
                    const data = await response.json();
                    alert('Failed to create document: ' + (data.detail || 'Unknown error'));
                }
            } catch (error) {
                alert('Error: ' + error.message);
            } finally {
                btn.disabled = false;
                btn.textContent = 'Create Document';
            }
        }
        
        // ========== IMAGE MODAL ==========
        function openImageModal(imageSrc) {
            document.getElementById('modal-image').src = imageSrc;
            document.getElementById('image-modal').classList.add('active');
        }
        
        function closeImageModal() {
            document.getElementById('image-modal').classList.remove('active');
        }
        
        // ========== UTILITY FUNCTIONS ==========
        function formatDate(dateStr) {
            if (!dateStr) return '-';
            const date = new Date(dateStr);
            return date.toLocaleDateString('en-AU', { day: 'numeric', month: 'short', year: 'numeric' });
        }
        
        function formatTime(dateStr) {
            if (!dateStr) return '-';
            const date = new Date(dateStr);
            return date.toLocaleTimeString('en-AU', { hour: '2-digit', minute: '2-digit' });
        }
        
        function formatDateTime(dateStr) {
            if (!dateStr) return '-';
            const date = new Date(dateStr);
            return date.toLocaleString('en-AU', { 
                day: 'numeric', 
                month: 'short', 
                hour: '2-digit', 
                minute: '2-digit' 
            });
        }
        
        function formatHours(hours) {
            if (!hours) return '0h 0m';
            const h = Math.floor(hours);
            const m = Math.round((hours - h) * 60);
            return `${h}h ${m}m`;
        }
        
        // ========== JOB SITES MANAGEMENT ==========
        let allJobSites = [];
        let allClients = [];
        
        async function loadJobSitesData() {
            const container = document.getElementById('jobsites-list');
            container.innerHTML = '<div class="loading">Loading job sites...</div>';
            
            try {
                // Load job sites and clients in parallel
                const [sitesResponse, clientsResponse] = await Promise.all([
                    fetch(`${API_BASE}/jobsites`),
                    fetch(`${API_BASE}/clients`)
                ]);
                
                const sitesData = await sitesResponse.json();
                const clientsData = await clientsResponse.json();
                
                allJobSites = sitesData.job_sites || [];
                allClients = clientsData.clients || [];
                
                // Update stats
                const activeSites = allJobSites.filter(s => s.is_active);
                document.getElementById('jobsites-total-count').textContent = allJobSites.length;
                document.getElementById('jobsites-active-count').textContent = activeSites.length;
                document.getElementById('jobsites-badge').textContent = activeSites.length;
                
                // Populate client dropdown
                const clientSelect = document.getElementById('jobsite-client');
                clientSelect.innerHTML = '<option value="">Select a client...</option>' + 
                    allClients.map(c => `<option value="${c.id}">${c.name}</option>`).join('');
                
                if (allJobSites.length === 0) {
                    container.innerHTML = `
                        <div class="empty-state">
                            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z" />
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z" />
                            </svg>
                            <h3>No job sites yet</h3>
                            <p>Add job sites using the button above</p>
                        </div>
                    `;
                    return;
                }
                
                container.innerHTML = allJobSites.map(site => renderJobSiteCard(site)).join('');
                
            } catch (error) {
                console.error('Error loading job sites:', error);
                container.innerHTML = `
                    <div class="empty-state">
                        <h3>Error loading job sites</h3>
                        <p>${error.message}</p>
                        <button class="refresh-btn" onclick="loadJobSitesData()" style="margin-top: 20px;">Try Again</button>
                    </div>
                `;
            }
        }
        
        function renderJobSiteCard(site) {
            const client = allClients.find(c => c.id === site.client_id);
            
            return `
                <div class="entry-card">
                    <div class="entry-header">
                        <div class="entry-worker">
                            <div class="name">${site.name}</div>
                            <div class="email">${site.address}</div>
                        </div>
                        <div class="entry-badge ${site.is_active ? 'verified' : ''}">${site.is_active ? 'Active' : 'Inactive'}</div>
                    </div>
                    
                    <div class="entry-details" style="margin-top: 12px;">
                        <div class="detail-item">
                            <div class="label">Client</div>
                            <div class="value">${client ? client.name : 'Not assigned'}</div>
                        </div>
                        <div class="detail-item">
                            <div class="label">Site Contact</div>
                            <div class="value">${site.contact_name || '-'}</div>
                        </div>
                        <div class="detail-item">
                            <div class="label">Contact Phone</div>
                            <div class="value">${site.contact_phone || '-'}</div>
                        </div>
                    </div>
                    
                    <div class="entry-actions" style="justify-content: flex-end;">
                        <button class="btn" style="background: #F3F4F6; color: #374151;" onclick="editJobSite(${site.id})">Edit</button>
                        ${site.is_active ? 
                            `<button class="btn btn-reject" onclick="toggleJobSiteStatus(${site.id}, false)">Deactivate</button>` :
                            `<button class="btn btn-approve" onclick="toggleJobSiteStatus(${site.id}, true)">Activate</button>`
                        }
                    </div>
                </div>
            `;
        }
        
        function showAddJobSiteModal() {
            document.getElementById('add-jobsite-modal').classList.add('active');
            document.getElementById('jobsite-modal-title').textContent = 'Add New Job Site';
            document.getElementById('save-jobsite-btn').textContent = 'Create Job Site';
            document.getElementById('jobsite-edit-id').value = '';
            document.getElementById('jobsite-name').value = '';
            document.getElementById('jobsite-address').value = '';
            document.getElementById('jobsite-client').value = '';
            document.getElementById('jobsite-contact-name').value = '';
            document.getElementById('jobsite-contact-phone').value = '';
        }
        
        function editJobSite(siteId) {
            const site = allJobSites.find(s => s.id === siteId);
            if (!site) return;
            
            document.getElementById('add-jobsite-modal').classList.add('active');
            document.getElementById('jobsite-modal-title').textContent = 'Edit Job Site';
            document.getElementById('save-jobsite-btn').textContent = 'Save Changes';
            document.getElementById('jobsite-edit-id').value = siteId;
            document.getElementById('jobsite-name').value = site.name || '';
            document.getElementById('jobsite-address').value = site.address || '';
            document.getElementById('jobsite-client').value = site.client_id || '';
            document.getElementById('jobsite-contact-name').value = site.contact_name || '';
            document.getElementById('jobsite-contact-phone').value = site.contact_phone || '';
        }
        
        function closeAddJobSiteModal() {
            document.getElementById('add-jobsite-modal').classList.remove('active');
        }
        
        async function saveJobSite() {
            const editId = document.getElementById('jobsite-edit-id').value;
            const name = document.getElementById('jobsite-name').value.trim();
            const address = document.getElementById('jobsite-address').value.trim();
            const clientId = document.getElementById('jobsite-client').value;
            const contactName = document.getElementById('jobsite-contact-name').value.trim();
            const contactPhone = document.getElementById('jobsite-contact-phone').value.trim();
            
            if (!name) {
                alert('Please enter a site name');
                return;
            }
            if (!address) {
                alert('Please enter an address');
                return;
            }
            
            const btn = document.getElementById('save-jobsite-btn');
            btn.disabled = true;
            btn.textContent = editId ? 'Saving...' : 'Creating...';
            
            try {
                const body = { name, address };
                if (clientId) body.client_id = parseInt(clientId);
                if (contactName) body.contact_name = contactName;
                if (contactPhone) body.contact_phone = contactPhone;
                
                let response;
                if (editId) {
                    // Update existing job site
                    response = await fetch(`${API_BASE}/jobsites/${editId}`, {
                        method: 'PUT',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(body)
                    });
                } else {
                    // Create new job site
                    response = await fetch(`${API_BASE}/jobsites`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(body)
                    });
                }
                
                if (response.ok) {
                    closeAddJobSiteModal();
                    loadJobSitesData();
                    alert(editId ? 'Job site updated successfully!' : 'Job site created successfully! It will now appear in the mobile app.');
                } else {
                    const data = await response.json();
                    alert('Failed to save job site: ' + (data.detail || 'Unknown error'));
                }
            } catch (error) {
                alert('Error: ' + error.message);
            } finally {
                btn.disabled = false;
                btn.textContent = editId ? 'Save Changes' : 'Create Job Site';
            }
        }
        
        async function toggleJobSiteStatus(siteId, activate) {
            if (!confirm(`Are you sure you want to ${activate ? 'activate' : 'deactivate'} this job site?`)) return;
            
            try {
                const response = await fetch(`${API_BASE}/jobsites/${siteId}/${activate ? 'activate' : 'deactivate'}`, {
                    method: 'PATCH'
                });
                
                if (response.ok) {
                    loadJobSitesData();
                } else {
                    alert('Failed to update job site status');
                }
            } catch (error) {
                alert('Error: ' + error.message);
            }
        }
        
        // ========== CLIENTS MANAGEMENT ==========
        async function loadClientsData() {
            const container = document.getElementById('clients-list');
            container.innerHTML = '<div class="loading">Loading clients...</div>';
            
            try {
                const response = await fetch(`${API_BASE}/clients`);
                const data = await response.json();
                
                allClients = data.clients || [];
                
                // Update stats
                const activeClients = allClients.filter(c => c.is_active);
                document.getElementById('clients-total-count').textContent = allClients.length;
                document.getElementById('clients-active-count').textContent = activeClients.length;
                document.getElementById('clients-badge').textContent = activeClients.length;
                
                if (allClients.length === 0) {
                    container.innerHTML = `
                        <div class="empty-state">
                            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4" />
                            </svg>
                            <h3>No clients yet</h3>
                            <p>Add clients using the button above</p>
                        </div>
                    `;
                    return;
                }
                
                container.innerHTML = allClients.map(client => renderClientCard(client)).join('');
                
            } catch (error) {
                console.error('Error loading clients:', error);
                container.innerHTML = `
                    <div class="empty-state">
                        <h3>Error loading clients</h3>
                        <p>${error.message}</p>
                        <button class="refresh-btn" onclick="loadClientsData()" style="margin-top: 20px;">Try Again</button>
                    </div>
                `;
            }
        }
        
        function renderClientCard(client) {
            // Count job sites for this client
            const siteCount = allJobSites.filter(s => s.client_id === client.id).length;
            
            return `
                <div class="entry-card">
                    <div class="entry-header">
                        <div class="entry-worker">
                            <div class="name">${client.name}</div>
                            <div class="email">${client.contact_name || ''} ${client.contact_email ? 'â€¢ ' + client.contact_email : ''}</div>
                        </div>
                        <div class="entry-badge ${client.is_active ? 'verified' : ''}">${client.is_active ? 'Active' : 'Inactive'}</div>
                    </div>
                    
                    <div class="entry-details" style="margin-top: 12px;">
                        <div class="detail-item">
                            <div class="label">Phone</div>
                            <div class="value">${client.contact_phone || '-'}</div>
                        </div>
                        <div class="detail-item">
                            <div class="label">Job Sites</div>
                            <div class="value">${siteCount}</div>
                        </div>
                    </div>
                    
                    ${client.address ? `
                        <div style="margin-top: 12px; padding-top: 12px; border-top: 1px solid #E5E7EB;">
                            <div style="font-size: 12px; color: #6B7280;">Address</div>
                            <div style="font-size: 14px; color: #374151;">${client.address}</div>
                        </div>
                    ` : ''}
                    
                    <div class="entry-actions" style="justify-content: flex-end; margin-top: 12px;">
                        <button class="btn" style="background: #F3F4F6; color: #374151;" onclick="editClient(${client.id})">Edit</button>
                    </div>
                </div>
            `;
        }
        
        function showAddClientModal() {
            document.getElementById('add-client-modal').classList.add('active');
            document.getElementById('client-modal-title').textContent = 'Add New Client';
            document.getElementById('save-client-btn').textContent = 'Create Client';
            document.getElementById('client-edit-id').value = '';
            document.getElementById('client-name').value = '';
            document.getElementById('client-contact-name').value = '';
            document.getElementById('client-email').value = '';
            document.getElementById('client-phone').value = '';
            document.getElementById('client-address').value = '';
        }
        
        function editClient(clientId) {
            const client = allClients.find(c => c.id === clientId);
            if (!client) return;
            
            document.getElementById('add-client-modal').classList.add('active');
            document.getElementById('client-modal-title').textContent = 'Edit Client';
            document.getElementById('save-client-btn').textContent = 'Save Changes';
            document.getElementById('client-edit-id').value = clientId;
            document.getElementById('client-name').value = client.name || '';
            document.getElementById('client-contact-name').value = client.contact_name || '';
            document.getElementById('client-email').value = client.contact_email || '';
            document.getElementById('client-phone').value = client.contact_phone || '';
            document.getElementById('client-address').value = client.address || '';
        }
        
        function closeAddClientModal() {
            document.getElementById('add-client-modal').classList.remove('active');
        }
        
        async function saveClient() {
            const editId = document.getElementById('client-edit-id').value;
            const name = document.getElementById('client-name').value.trim();
            const contactName = document.getElementById('client-contact-name').value.trim();
            const email = document.getElementById('client-email').value.trim();
            const phone = document.getElementById('client-phone').value.trim();
            const address = document.getElementById('client-address').value.trim();
            
            if (!name) {
                alert('Please enter a company name');
                return;
            }
            
            const btn = document.getElementById('save-client-btn');
            btn.disabled = true;
            btn.textContent = editId ? 'Saving...' : 'Creating...';
            
            try {
                const body = { name };
                if (contactName) body.contact_name = contactName;
                if (email) body.contact_email = email;
                if (phone) body.contact_phone = phone;
                if (address) body.address = address;
                
                let response;
                if (editId) {
                    // Update existing client
                    response = await fetch(`${API_BASE}/clients/admin/${editId}`, {
                        method: 'PUT',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(body)
                    });
                } else {
                    // Create new client
                    response = await fetch(`${API_BASE}/clients/admin`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(body)
                    });
                }
                
                if (response.ok) {
                    closeAddClientModal();
                    loadClientsData();
                    // Also refresh job sites to update the client dropdown
                    loadJobSitesData();
                    alert(editId ? 'Client updated successfully!' : 'Client created successfully!');
                } else {
                    const data = await response.json();
                    alert('Failed to save client: ' + (data.detail || 'Unknown error'));
                }
            } catch (error) {
                alert('Error: ' + error.message);
            } finally {
                btn.disabled = false;
                btn.textContent = editId ? 'Save Changes' : 'Create Client';
            }
        }
        
        // Load all data on page load
        loadAllData();
        
        // Auto-refresh every 30 seconds
        setInterval(loadAllData, 30000);
        
        // Close modal with Escape key
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape') closeImageModal();
        });
        
        // ========== WORKERS DIRECTORY ==========
        let allWorkers = [];
        
        async function loadWorkersData() {
            try {
                const response = await fetch(`${API_BASE}/users/admin/workers?active_only=false`);
                const data = await response.json();
                allWorkers = data.workers || [];
                
                const active = allWorkers.filter(w => w.is_active).length;
                document.getElementById('workers-total-count').textContent = allWorkers.length;
                document.getElementById('workers-active-count').textContent = active;
                document.getElementById('workers-badge').textContent = allWorkers.length;
                
                renderWorkersList();
            } catch (error) {
                console.error('Error loading workers:', error);
                document.getElementById('workers-list').innerHTML = '<p style="color: #EF4444;">Error loading workers</p>';
            }
        }
        
        function renderWorkersList() {
            const list = document.getElementById('workers-list');
            
            if (allWorkers.length === 0) {
                list.innerHTML = '<p style="color: #6B7280; padding: 20px;">No workers found. Click "Add New Worker" to create one.</p>';
                return;
            }
            
            list.innerHTML = allWorkers.map(worker => renderWorkerCard(worker)).join('');
        }
        
        function renderWorkerCard(worker) {
            const fullAddress = [worker.address, worker.suburb, worker.state, worker.postcode].filter(Boolean).join(', ');
            
            return `
                <div class="entry-card">
                    <div class="entry-header">
                        <div class="entry-worker">
                            <div class="name">${worker.first_name} ${worker.surname}</div>
                            <div class="email">${worker.email}</div>
                        </div>
                        <div class="entry-badge ${worker.is_active ? 'verified' : ''}">${worker.is_active ? 'Active' : 'Inactive'}</div>
                    </div>
                    
                    <div class="entry-details" style="margin-top: 12px;">
                        <div class="detail-item">
                            <div class="label">Phone</div>
                            <div class="value">${worker.phone || '-'}</div>
                        </div>
                        <div class="detail-item">
                            <div class="label">Employment</div>
                            <div class="value" style="text-transform: capitalize;">${(worker.employment_type || 'casual').replace('_', ' ')}</div>
                        </div>
                        <div class="detail-item">
                            <div class="label">Base Rate</div>
                            <div class="value">$${(worker.base_pay_rate || 0).toFixed(2)}/hr</div>
                        </div>
                        <div class="detail-item">
                            <div class="label">Start Date</div>
                            <div class="value">${worker.start_date || '-'}</div>
                        </div>
                    </div>
                    
                    ${fullAddress ? `
                    <div style="margin-top: 8px; font-size: 13px; color: #6B7280;">
                        <strong>Address:</strong> ${fullAddress}
                    </div>
                    ` : ''}
                    
                    ${worker.emergency_contact_name ? `
                    <div style="margin-top: 8px; font-size: 13px; color: #6B7280;">
                        <strong>Emergency:</strong> ${worker.emergency_contact_name} (${worker.emergency_contact_relationship || 'N/A'}) - ${worker.emergency_contact_phone || 'No phone'}
                    </div>
                    ` : ''}
                    
                    <div class="entry-actions" style="justify-content: flex-end; margin-top: 12px;">
                        <button class="btn" style="background: #F3F4F6; color: #374151; padding: 8px 12px;" onclick="editWorker(${worker.id})">Edit</button>
                        <button class="btn" style="background: #FEF3C7; color: #92400E; padding: 8px 12px;" onclick="resetWorkerPassword(${worker.id})">Reset Password</button>
                        ${worker.is_active ? 
                            `<button class="btn btn-reject" style="padding: 8px 12px;" onclick="toggleWorkerStatus(${worker.id}, false)">Deactivate</button>` :
                            `<button class="btn btn-approve" style="padding: 8px 12px;" onclick="toggleWorkerStatus(${worker.id}, true)">Activate</button>`
                        }
                    </div>
                </div>
            `;
        }
        
        function showAddWorkerModal() {
            document.getElementById('add-worker-modal').classList.add('active');
            document.getElementById('worker-modal-title').textContent = 'Add New Worker';
            document.getElementById('save-worker-btn').textContent = 'Create Worker';
            document.getElementById('worker-edit-id').value = '';
            
            // Clear all fields
            document.getElementById('worker-first-name').value = '';
            document.getElementById('worker-surname').value = '';
            document.getElementById('worker-email').value = '';
            document.getElementById('worker-email').disabled = false;
            document.getElementById('worker-phone').value = '';
            document.getElementById('worker-dob').value = '';
            document.getElementById('worker-start-date').value = '';
            document.getElementById('worker-address').value = '';
            document.getElementById('worker-suburb').value = '';
            document.getElementById('worker-state').value = '';
            document.getElementById('worker-postcode').value = '';
            document.getElementById('worker-emergency-name').value = '';
            document.getElementById('worker-emergency-phone').value = '';
            document.getElementById('worker-emergency-relationship').value = '';
            document.getElementById('worker-bank-name').value = '';
            document.getElementById('worker-bank-bsb').value = '';
            document.getElementById('worker-bank-account').value = '';
            document.getElementById('worker-tfn').value = '';
            document.getElementById('worker-base-rate').value = '0';
            document.getElementById('worker-overtime-rate').value = '0';
            document.getElementById('worker-weekend-rate').value = '0';
            document.getElementById('worker-night-rate').value = '0';
            document.getElementById('worker-employment-type').value = 'casual';
            document.getElementById('worker-role').value = 'worker';
        }
        
        function editWorker(workerId) {
            const worker = allWorkers.find(w => w.id === workerId);
            if (!worker) return;
            
            document.getElementById('add-worker-modal').classList.add('active');
            document.getElementById('worker-modal-title').textContent = 'Edit Worker';
            document.getElementById('save-worker-btn').textContent = 'Save Changes';
            document.getElementById('worker-edit-id').value = workerId;
            
            // Populate fields
            document.getElementById('worker-first-name').value = worker.first_name || '';
            document.getElementById('worker-surname').value = worker.surname || '';
            document.getElementById('worker-email').value = worker.email || '';
            document.getElementById('worker-email').disabled = true; // Can't change email
            document.getElementById('worker-phone').value = worker.phone || '';
            document.getElementById('worker-dob').value = worker.date_of_birth || '';
            document.getElementById('worker-start-date').value = worker.start_date || '';
            document.getElementById('worker-address').value = worker.address || '';
            document.getElementById('worker-suburb').value = worker.suburb || '';
            document.getElementById('worker-state').value = worker.state || '';
            document.getElementById('worker-postcode').value = worker.postcode || '';
            document.getElementById('worker-emergency-name').value = worker.emergency_contact_name || '';
            document.getElementById('worker-emergency-phone').value = worker.emergency_contact_phone || '';
            document.getElementById('worker-emergency-relationship').value = worker.emergency_contact_relationship || '';
            document.getElementById('worker-bank-name').value = worker.bank_account_name || '';
            document.getElementById('worker-bank-bsb').value = worker.bank_bsb || '';
            document.getElementById('worker-bank-account').value = worker.bank_account_number || '';
            document.getElementById('worker-tfn').value = worker.tax_file_number || '';
            document.getElementById('worker-base-rate').value = worker.base_pay_rate || 0;
            document.getElementById('worker-overtime-rate').value = worker.overtime_pay_rate || 0;
            document.getElementById('worker-weekend-rate').value = worker.weekend_pay_rate || 0;
            document.getElementById('worker-night-rate').value = worker.night_pay_rate || 0;
            document.getElementById('worker-employment-type').value = worker.employment_type || 'casual';
            document.getElementById('worker-role').value = worker.role || 'worker';
        }
        
        function closeAddWorkerModal() {
            document.getElementById('add-worker-modal').classList.remove('active');
        }
        
        async function saveWorker() {
            const editId = document.getElementById('worker-edit-id').value;
            const firstName = document.getElementById('worker-first-name').value.trim();
            const surname = document.getElementById('worker-surname').value.trim();
            const email = document.getElementById('worker-email').value.trim();
            
            if (!firstName || !surname) {
                alert('Please enter first name and surname');
                return;
            }
            if (!editId && !email) {
                alert('Please enter an email address');
                return;
            }
            
            const btn = document.getElementById('save-worker-btn');
            btn.disabled = true;
            btn.textContent = editId ? 'Saving...' : 'Creating...';
            
            try {
                const workerData = {
                    first_name: firstName,
                    surname: surname,
                    phone: document.getElementById('worker-phone').value.trim() || null,
                    address: document.getElementById('worker-address').value.trim() || null,
                    suburb: document.getElementById('worker-suburb').value.trim() || null,
                    state: document.getElementById('worker-state').value || null,
                    postcode: document.getElementById('worker-postcode').value.trim() || null,
                    date_of_birth: document.getElementById('worker-dob').value || null,
                    start_date: document.getElementById('worker-start-date').value || null,
                    emergency_contact_name: document.getElementById('worker-emergency-name').value.trim() || null,
                    emergency_contact_phone: document.getElementById('worker-emergency-phone').value.trim() || null,
                    emergency_contact_relationship: document.getElementById('worker-emergency-relationship').value.trim() || null,
                    bank_account_name: document.getElementById('worker-bank-name').value.trim() || null,
                    bank_bsb: document.getElementById('worker-bank-bsb').value.trim() || null,
                    bank_account_number: document.getElementById('worker-bank-account').value.trim() || null,
                    tax_file_number: document.getElementById('worker-tfn').value.trim() || null,
                    base_pay_rate: parseFloat(document.getElementById('worker-base-rate').value) || 0,
                    overtime_pay_rate: parseFloat(document.getElementById('worker-overtime-rate').value) || 0,
                    weekend_pay_rate: parseFloat(document.getElementById('worker-weekend-rate').value) || 0,
                    night_pay_rate: parseFloat(document.getElementById('worker-night-rate').value) || 0,
                    employment_type: document.getElementById('worker-employment-type').value,
                    role: document.getElementById('worker-role').value
                };
                
                let response;
                if (editId) {
                    response = await fetch(`${API_BASE}/users/admin/workers/${editId}`, {
                        method: 'PUT',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(workerData)
                    });
                } else {
                    workerData.email = email;
                    response = await fetch(`${API_BASE}/users/admin/workers`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(workerData)
                    });
                }
                
                if (response.ok) {
                    const result = await response.json();
                    closeAddWorkerModal();
                    loadWorkersData();
                    
                    if (!editId && result.temp_password) {
                        alert(`Worker created successfully!\n\nTemporary Password: ${result.temp_password}\n\nPlease share this with the worker so they can log in.`);
                    } else {
                        alert(editId ? 'Worker updated successfully!' : 'Worker created successfully!');
                    }
                } else {
                    const data = await response.json();
                    alert('Failed to save worker: ' + (data.detail || 'Unknown error'));
                }
            } catch (error) {
                alert('Error: ' + error.message);
            } finally {
                btn.disabled = false;
                btn.textContent = editId ? 'Save Changes' : 'Create Worker';
            }
        }
        
        async function toggleWorkerStatus(workerId, activate) {
            const action = activate ? 'activate' : 'deactivate';
            if (!confirm(`Are you sure you want to ${action} this worker?`)) return;
            
            try {
                const response = await fetch(`${API_BASE}/users/admin/workers/${workerId}/${action}`, {
                    method: 'PATCH'
                });
                
                if (response.ok) {
                    loadWorkersData();
                } else {
                    alert('Failed to update worker status');
                }
            } catch (error) {
                alert('Error: ' + error.message);
            }
        }
        
        async function resetWorkerPassword(workerId) {
            if (!confirm('Reset this worker\'s password? They will receive a new temporary password.')) return;
            
            try {
                const response = await fetch(`${API_BASE}/users/admin/workers/${workerId}/reset-password`, {
                    method: 'POST'
                });
                
                if (response.ok) {
                    const result = await response.json();
                    alert(`Password reset!\n\nNew Temporary Password: ${result.temp_password}\n\nPlease share this with the worker.`);
                } else {
                    alert('Failed to reset password');
                }
            } catch (error) {
                alert('Error: ' + error.message);
            }
        }
        
        // ========== MYOB INTEGRATION ==========
        let myobEntries = [];
        let myobWorkers = [];
        let myobClients = [];
        
        async function loadMYOBData() {
            // Load connection status
            try {
                const statusResponse = await fetch(`${API_BASE}/myob/status`);
                const status = await statusResponse.json();
                
                updateMYOBStatus(status);
                
                if (status.is_connected) {
                    // Load export data
                    loadMYOBEntries();
                    loadMYOBWorkers();
                    loadMYOBClients();
                    loadMYOBHistory();
                }
            } catch (error) {
                console.error('Error loading MYOB data:', error);
                document.getElementById('myob-status').textContent = 'Error';
            }
        }
        
        function updateMYOBStatus(status) {
            const statusEl = document.getElementById('myob-status');
            const companyEl = document.getElementById('myob-company');
            const notConnected = document.getElementById('myob-not-connected');
            const connected = document.getElementById('myob-connected');
            const badge = document.getElementById('myob-badge');
            
            if (status.is_connected) {
                statusEl.textContent = 'Connected';
                statusEl.style.color = '#10B981';
                companyEl.textContent = status.company_file_name || 'No file selected';
                notConnected.style.display = 'none';
                connected.style.display = 'block';
                document.getElementById('myob-connected-company').textContent = 
                    'Company: ' + (status.company_file_name || 'No file selected');
                badge.textContent = 'âœ“';
                badge.style.background = '#10B981';
            } else {
                statusEl.textContent = 'Not Connected';
                statusEl.style.color = '#F59E0B';
                companyEl.textContent = '-';
                notConnected.style.display = 'block';
                connected.style.display = 'none';
                badge.textContent = 'Setup';
                badge.style.background = '#F59E0B';
            }
        }
        
        async function saveMYOBCredentials() {
            const clientId = document.getElementById('myob-client-id').value.trim();
            const clientSecret = document.getElementById('myob-client-secret').value.trim();
            
            if (!clientId || !clientSecret) {
                alert('Please enter both Client ID and Client Secret');
                return;
            }
            
            try {
                const response = await fetch(`${API_BASE}/myob/credentials`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ client_id: clientId, client_secret: clientSecret })
                });
                
                if (response.ok) {
                    alert('Credentials saved! Now click "Connect to MYOB" to authorize.');
                } else {
                    alert('Failed to save credentials');
                }
            } catch (error) {
                alert('Error: ' + error.message);
            }
        }
        
        async function connectMYOB() {
            try {
                const response = await fetch(`${API_BASE}/myob/auth-url`);
                const data = await response.json();
                
                if (data.auth_url) {
                    window.open(data.auth_url, '_blank');
                } else {
                    alert('Please save your MYOB credentials first');
                }
            } catch (error) {
                alert('Error: ' + error.message);
            }
        }
        
        async function disconnectMYOB() {
            if (!confirm('Are you sure you want to disconnect from MYOB?')) return;
            
            try {
                await fetch(`${API_BASE}/myob/disconnect`, { method: 'POST' });
                loadMYOBData();
            } catch (error) {
                alert('Error: ' + error.message);
            }
        }
        
        function switchMYOBTab(tab) {
            document.querySelectorAll('#myob-section .tab').forEach(t => t.classList.remove('active'));
            document.querySelector(`#myob-section .tab[data-myob-tab="${tab}"]`).classList.add('active');
            
            document.querySelectorAll('.myob-tab-content').forEach(c => c.style.display = 'none');
            document.getElementById(`myob-${tab}-tab`).style.display = 'block';
        }
        
        async function loadMYOBEntries() {
            try {
                const response = await fetch(`${API_BASE}/myob/approved-entries`);
                const data = await response.json();
                myobEntries = data.entries || [];
                
                document.getElementById('myob-ready-count').textContent = 
                    myobEntries.filter(e => !e.already_exported).length;
                
                renderMYOBEntries();
            } catch (error) {
                console.error('Error loading entries:', error);
            }
        }
        
        function renderMYOBEntries() {
            const list = document.getElementById('myob-entries-list');
            
            if (myobEntries.length === 0) {
                list.innerHTML = '<tr><td colspan="7" style="padding: 20px; text-align: center; color: #6B7280;">No approved entries to export</td></tr>';
                return;
            }
            
            list.innerHTML = myobEntries.map(entry => `
                <tr style="border-bottom: 1px solid #E5E7EB;">
                    <td style="padding: 12px 8px;">
                        <input type="checkbox" class="entry-checkbox" value="${entry.id}" ${entry.already_exported ? 'disabled' : ''}>
                    </td>
                    <td style="padding: 12px 8px;">${entry.date || '-'}</td>
                    <td style="padding: 12px 8px;">${entry.worker_name}</td>
                    <td style="padding: 12px 8px;">${entry.client_name}</td>
                    <td style="padding: 12px 8px;">${entry.job_site}</td>
                    <td style="padding: 12px 8px; text-align: right;">${entry.hours.toFixed(1)}</td>
                    <td style="padding: 12px 8px; text-align: center;">
                        ${entry.already_exported 
                            ? '<span style="color: #10B981; font-size: 12px;">âœ“ Exported</span>'
                            : '<span style="color: #F59E0B; font-size: 12px;">Ready</span>'}
                    </td>
                </tr>
            `).join('');
        }
        
        function toggleSelectAll() {
            const checked = document.getElementById('select-all-entries').checked;
            document.querySelectorAll('.entry-checkbox:not(:disabled)').forEach(cb => cb.checked = checked);
        }
        
        async function exportSelectedToMYOB() {
            const selectedIds = Array.from(document.querySelectorAll('.entry-checkbox:checked'))
                .map(cb => parseInt(cb.value));
            
            if (selectedIds.length === 0) {
                alert('Please select entries to export');
                return;
            }
            
            const exportInvoices = document.getElementById('export-invoices').checked;
            const exportPayroll = document.getElementById('export-payroll').checked;
            
            if (!exportInvoices && !exportPayroll) {
                alert('Please select at least one export type (Invoices or Payroll)');
                return;
            }
            
            try {
                const response = await fetch(`${API_BASE}/myob/export`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        entry_ids: selectedIds,
                        export_invoices: exportInvoices,
                        export_payroll: exportPayroll
                    })
                });
                
                const result = await response.json();
                
                let message = `Export complete!\n`;
                if (exportInvoices) message += `Invoices created: ${result.invoices_created}\n`;
                if (exportPayroll) message += `Payroll entries: ${result.payroll_entries}\n`;
                if (result.errors && result.errors.length > 0) {
                    message += `\nErrors:\n${result.errors.join('\n')}`;
                }
                
                alert(message);
                loadMYOBEntries();
                loadMYOBHistory();
            } catch (error) {
                alert('Export failed: ' + error.message);
            }
        }
        
        async function loadMYOBWorkers() {
            try {
                const response = await fetch(`${API_BASE}/myob/workers`);
                const data = await response.json();
                myobWorkers = data.workers || [];
                renderMYOBWorkers();
            } catch (error) {
                console.error('Error loading workers:', error);
            }
        }
        
        function renderMYOBWorkers() {
            const list = document.getElementById('workers-rates-list');
            
            if (myobWorkers.length === 0) {
                list.innerHTML = '<p style="color: #6B7280;">No workers found</p>';
                return;
            }
            
            list.innerHTML = myobWorkers.map(worker => `
                <div style="border: 1px solid #E5E7EB; border-radius: 8px; padding: 16px; margin-bottom: 12px;">
                    <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 12px;">
                        <div>
                            <div style="font-weight: 600; color: #1F2937;">${worker.name}</div>
                            <div style="font-size: 13px; color: #6B7280;">${worker.email}</div>
                        </div>
                        <button onclick="saveWorkerRates(${worker.id})" class="btn btn-approve" style="padding: 6px 12px; font-size: 13px;">Save</button>
                    </div>
                    <div style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 12px;">
                        <div>
                            <label style="display: block; font-size: 12px; color: #6B7280; margin-bottom: 4px;">Base Rate</label>
                            <input type="number" id="worker-${worker.id}-base" value="${worker.base_pay_rate}" step="0.01" style="width: 100%; padding: 8px; border: 1px solid #E5E7EB; border-radius: 6px;">
                        </div>
                        <div>
                            <label style="display: block; font-size: 12px; color: #6B7280; margin-bottom: 4px;">Overtime Rate</label>
                            <input type="number" id="worker-${worker.id}-overtime" value="${worker.overtime_pay_rate}" step="0.01" style="width: 100%; padding: 8px; border: 1px solid #E5E7EB; border-radius: 6px;">
                        </div>
                        <div>
                            <label style="display: block; font-size: 12px; color: #6B7280; margin-bottom: 4px;">Weekend Rate</label>
                            <input type="number" id="worker-${worker.id}-weekend" value="${worker.weekend_pay_rate}" step="0.01" style="width: 100%; padding: 8px; border: 1px solid #E5E7EB; border-radius: 6px;">
                        </div>
                        <div>
                            <label style="display: block; font-size: 12px; color: #6B7280; margin-bottom: 4px;">Night Rate</label>
                            <input type="number" id="worker-${worker.id}-night" value="${worker.night_pay_rate}" step="0.01" style="width: 100%; padding: 8px; border: 1px solid #E5E7EB; border-radius: 6px;">
                        </div>
                    </div>
                </div>
            `).join('');
        }
        
        async function saveWorkerRates(workerId) {
            const rates = {
                base_pay_rate: parseFloat(document.getElementById(`worker-${workerId}-base`).value) || 0,
                overtime_pay_rate: parseFloat(document.getElementById(`worker-${workerId}-overtime`).value) || 0,
                weekend_pay_rate: parseFloat(document.getElementById(`worker-${workerId}-weekend`).value) || 0,
                night_pay_rate: parseFloat(document.getElementById(`worker-${workerId}-night`).value) || 0
            };
            
            try {
                const response = await fetch(`${API_BASE}/myob/workers/${workerId}/rates`, {
                    method: 'PUT',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(rates)
                });
                
                if (response.ok) {
                    alert('Pay rates saved!');
                } else {
                    alert('Failed to save rates');
                }
            } catch (error) {
                alert('Error: ' + error.message);
            }
        }
        
        async function loadMYOBClients() {
            try {
                const response = await fetch(`${API_BASE}/myob/clients`);
                const data = await response.json();
                myobClients = data.clients || [];
                renderMYOBClients();
            } catch (error) {
                console.error('Error loading clients:', error);
            }
        }
        
        function renderMYOBClients() {
            const list = document.getElementById('clients-rates-list');
            
            if (myobClients.length === 0) {
                list.innerHTML = '<p style="color: #6B7280;">No clients found</p>';
                return;
            }
            
            list.innerHTML = myobClients.map(client => `
                <div style="border: 1px solid #E5E7EB; border-radius: 8px; padding: 16px; margin-bottom: 12px;">
                    <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 12px;">
                        <div>
                            <div style="font-weight: 600; color: #1F2937;">${client.name}</div>
                        </div>
                        <button onclick="saveClientRates(${client.id})" class="btn btn-approve" style="padding: 6px 12px; font-size: 13px;">Save</button>
                    </div>
                    <div style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 12px;">
                        <div>
                            <label style="display: block; font-size: 12px; color: #6B7280; margin-bottom: 4px;">Hourly Rate</label>
                            <input type="number" id="client-${client.id}-hourly" value="${client.hourly_billing_rate}" step="0.01" style="width: 100%; padding: 8px; border: 1px solid #E5E7EB; border-radius: 6px;">
                        </div>
                        <div>
                            <label style="display: block; font-size: 12px; color: #6B7280; margin-bottom: 4px;">Overtime Rate</label>
                            <input type="number" id="client-${client.id}-overtime" value="${client.overtime_billing_rate}" step="0.01" style="width: 100%; padding: 8px; border: 1px solid #E5E7EB; border-radius: 6px;">
                        </div>
                        <div>
                            <label style="display: block; font-size: 12px; color: #6B7280; margin-bottom: 4px;">Weekend Rate</label>
                            <input type="number" id="client-${client.id}-weekend" value="${client.weekend_billing_rate}" step="0.01" style="width: 100%; padding: 8px; border: 1px solid #E5E7EB; border-radius: 6px;">
                        </div>
                        <div>
                            <label style="display: block; font-size: 12px; color: #6B7280; margin-bottom: 4px;">Night Rate</label>
                            <input type="number" id="client-${client.id}-night" value="${client.night_billing_rate}" step="0.01" style="width: 100%; padding: 8px; border: 1px solid #E5E7EB; border-radius: 6px;">
                        </div>
                    </div>
                </div>
            `).join('');
        }
        
        async function saveClientRates(clientId) {
            const rates = {
                hourly_billing_rate: parseFloat(document.getElementById(`client-${clientId}-hourly`).value) || 0,
                overtime_billing_rate: parseFloat(document.getElementById(`client-${clientId}-overtime`).value) || 0,
                weekend_billing_rate: parseFloat(document.getElementById(`client-${clientId}-weekend`).value) || 0,
                night_billing_rate: parseFloat(document.getElementById(`client-${clientId}-night`).value) || 0
            };
            
            try {
                const response = await fetch(`${API_BASE}/myob/clients/${clientId}/rates`, {
                    method: 'PUT',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(rates)
                });
                
                if (response.ok) {
                    alert('Billing rates saved!');
                } else {
                    alert('Failed to save rates');
                }
            } catch (error) {
                alert('Error: ' + error.message);
            }
        }
        
        async function loadMYOBHistory() {
            try {
                const response = await fetch(`${API_BASE}/myob/export-history`);
                const data = await response.json();
                renderMYOBHistory(data.exports || []);
            } catch (error) {
                console.error('Error loading history:', error);
            }
        }
        
        function renderMYOBHistory(exports) {
            const list = document.getElementById('myob-history-list');
            
            if (exports.length === 0) {
                list.innerHTML = '<tr><td colspan="4" style="padding: 20px; text-align: center; color: #6B7280;">No export history</td></tr>';
                return;
            }
            
            list.innerHTML = exports.map(exp => `
                <tr style="border-bottom: 1px solid #E5E7EB;">
                    <td style="padding: 12px 8px;">${exp.exported_at ? new Date(exp.exported_at).toLocaleString() : '-'}</td>
                    <td style="padding: 12px 8px; text-transform: capitalize;">${exp.export_type || '-'}</td>
                    <td style="padding: 12px 8px; text-align: right;">
                        ${exp.invoice_amount ? '$' + exp.invoice_amount.toFixed(2) : ''}
                        ${exp.pay_amount ? '$' + exp.pay_amount.toFixed(2) : ''}
                        ${!exp.invoice_amount && !exp.pay_amount ? '-' : ''}
                    </td>
                    <td style="padding: 12px 8px; text-align: center;">
                        <span style="color: ${exp.status === 'success' ? '#10B981' : '#EF4444'}; font-size: 12px;">
                            ${exp.status === 'success' ? 'âœ“ Success' : 'âœ— Failed'}
                        </span>
                    </td>
                </tr>
            `).join('');
        }
        
        // Check for MYOB callback
        if (window.location.search.includes('myob=connected')) {
            alert('Successfully connected to MYOB!');
            window.history.replaceState({}, document.title, '/admin');
        }
        
        // CSV Download function
        function downloadCSV(type) {
            const url = `${API_BASE}/myob/export-csv/${type}`;
            
            // Create a temporary link and click it to download
            const link = document.createElement('a');
            link.href = url;
            link.download = `${type}_export.csv`;
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }
    </script>
</body>
</html>
