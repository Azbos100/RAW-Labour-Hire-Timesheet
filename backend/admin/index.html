<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RAW Labour Hire - Admin Dashboard</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        .tab-active { border-bottom: 3px solid #1E3A8A; color: #1E3A8A; }
        .status-draft { background: #F3F4F6; color: #6B7280; }
        .status-submitted { background: #FEF3C7; color: #92400E; }
        .status-approved { background: #D1FAE5; color: #065F46; }
        .status-rejected { background: #FEE2E2; color: #991B1B; }
        .loader { border: 3px solid #f3f3f3; border-top: 3px solid #1E3A8A; border-radius: 50%; width: 24px; height: 24px; animation: spin 1s linear infinite; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        .modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 1000; }
        .modal.active { display: flex; justify-content: center; align-items: center; }
        .signature-img { max-width: 300px; border: 1px solid #E5E7EB; border-radius: 8px; background: white; }
        
        /* Toggle Switch Styles */
        .toggle-switch {
            position: relative;
            width: 44px;
            height: 24px;
            background-color: #D1D5DB;
            border-radius: 12px;
            border: none;
            cursor: pointer;
            transition: background-color 0.2s;
            flex-shrink: 0;
        }
        .toggle-switch.active {
            background-color: #2563EB;
        }
        .toggle-slider {
            position: absolute;
            top: 2px;
            left: 2px;
            width: 20px;
            height: 20px;
            background-color: white;
            border-radius: 50%;
            transition: transform 0.2s;
            box-shadow: 0 1px 3px rgba(0,0,0,0.2);
        }
        .toggle-switch.active .toggle-slider {
            transform: translateX(20px);
        }
    </style>
</head>
<body class="bg-gray-100 min-h-screen">
    <!-- Header -->
    <header class="bg-blue-900 text-white shadow-lg">
        <div class="max-w-7xl mx-auto px-4 py-4 flex items-center justify-between">
            <div class="flex items-center gap-4">
                <img src="raw-logo.png" alt="RAW Logo" class="h-10 w-10 object-contain bg-white rounded p-1" onerror="this.style.display='none'">
                <div>
                    <h1 class="text-xl font-bold">RAW Labour Hire</h1>
                    <p class="text-blue-200 text-sm">Admin Dashboard</p>
                </div>
            </div>
            <div class="flex items-center gap-4">
                <span id="lastUpdated" class="text-sm text-blue-200"></span>
                <button onclick="refreshData()" class="bg-blue-800 hover:bg-blue-700 px-4 py-2 rounded-lg flex items-center gap-2">
                    <i class="fas fa-sync-alt"></i> Refresh
                </button>
            </div>
        </div>
    </header>

    <!-- Navigation Tabs -->
    <nav class="bg-white shadow">
        <div class="max-w-7xl mx-auto px-4">
            <div class="flex gap-8 overflow-x-auto">
                <button onclick="switchTab('timesheets')" id="tab-timesheets" class="py-4 px-2 font-medium tab-active whitespace-nowrap">
                    <i class="fas fa-clock mr-2"></i>Timesheets
                </button>
                <button onclick="switchTab('tickets')" id="tab-tickets" class="py-4 px-2 font-medium text-gray-500 hover:text-gray-700 whitespace-nowrap">
                    <i class="fas fa-id-card mr-2"></i>Tickets
                </button>
                <button onclick="switchTab('inductions')" id="tab-inductions" class="py-4 px-2 font-medium text-gray-500 hover:text-gray-700 whitespace-nowrap">
                    <i class="fas fa-clipboard-check mr-2"></i>Inductions
                </button>
                <button onclick="switchTab('workers')" id="tab-workers" class="py-4 px-2 font-medium text-gray-500 hover:text-gray-700 whitespace-nowrap">
                    <i class="fas fa-users mr-2"></i>Workers
                </button>
                <button onclick="switchTab('clients')" id="tab-clients" class="py-4 px-2 font-medium text-gray-500 hover:text-gray-700 whitespace-nowrap">
                    <i class="fas fa-building mr-2"></i>Clients & Job Sites
                </button>
                <button onclick="switchTab('notifications')" id="tab-notifications" class="py-4 px-2 font-medium text-gray-500 hover:text-gray-700 whitespace-nowrap">
                    <i class="fas fa-bell mr-2"></i>Notifications
                </button>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <main class="max-w-7xl mx-auto px-4 py-6">
        <!-- Timesheets Tab -->
        <div id="content-timesheets">
            <!-- Stats Cards -->
            <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-6">
                <div class="bg-white rounded-xl shadow p-4">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-sm text-gray-500">Pending Approval</p>
                            <p id="stat-pending" class="text-2xl font-bold text-yellow-600">-</p>
                        </div>
                        <div class="bg-yellow-100 p-3 rounded-full">
                            <i class="fas fa-hourglass-half text-yellow-600"></i>
                        </div>
                    </div>
                </div>
                <div class="bg-white rounded-xl shadow p-4">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-sm text-gray-500">Approved This Week</p>
                            <p id="stat-approved" class="text-2xl font-bold text-green-600">-</p>
                        </div>
                        <div class="bg-green-100 p-3 rounded-full">
                            <i class="fas fa-check-circle text-green-600"></i>
                        </div>
                    </div>
                </div>
                <div class="bg-white rounded-xl shadow p-4">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-sm text-gray-500">Total Hours This Week</p>
                            <p id="stat-hours" class="text-2xl font-bold text-blue-600">-</p>
                        </div>
                        <div class="bg-blue-100 p-3 rounded-full">
                            <i class="fas fa-clock text-blue-600"></i>
                        </div>
                    </div>
                </div>
                <div class="bg-white rounded-xl shadow p-4">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-sm text-gray-500">Active Workers</p>
                            <p id="stat-workers" class="text-2xl font-bold text-purple-600">-</p>
                        </div>
                        <div class="bg-purple-100 p-3 rounded-full">
                            <i class="fas fa-user-check text-purple-600"></i>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Filter Controls -->
            <div class="bg-white rounded-xl shadow p-4 mb-6">
                <div class="flex flex-wrap gap-4 items-center">
                    <div>
                        <label class="block text-sm text-gray-500 mb-1">Status</label>
                        <select id="filter-status" onchange="loadTimesheets()" class="border rounded-lg px-3 py-2">
                            <option value="">All Statuses</option>
                            <option value="submitted" selected>Pending Approval</option>
                            <option value="approved">Approved</option>
                            <option value="draft">Draft</option>
                            <option value="rejected">Rejected</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm text-gray-500 mb-1">Worker</label>
                        <select id="filter-worker" onchange="loadTimesheets()" class="border rounded-lg px-3 py-2">
                            <option value="">All Workers</option>
                        </select>
                    </div>
                </div>
            </div>

            <!-- Timesheets Table -->
            <div class="bg-white rounded-xl shadow overflow-hidden">
                <div class="overflow-x-auto">
                    <table class="w-full">
                        <thead class="bg-gray-50">
                            <tr>
                                <th class="px-4 py-3 text-left text-sm font-medium text-gray-500">Docket #</th>
                                <th class="px-4 py-3 text-left text-sm font-medium text-gray-500">Worker</th>
                                <th class="px-4 py-3 text-left text-sm font-medium text-gray-500">Week</th>
                                <th class="px-4 py-3 text-left text-sm font-medium text-gray-500">Client</th>
                                <th class="px-4 py-3 text-left text-sm font-medium text-gray-500">Hours</th>
                                <th class="px-4 py-3 text-left text-sm font-medium text-gray-500">Status</th>
                                <th class="px-4 py-3 text-left text-sm font-medium text-gray-500">Actions</th>
                            </tr>
                        </thead>
                        <tbody id="timesheets-table" class="divide-y divide-gray-100">
                            <tr><td colspan="7" class="px-4 py-8 text-center text-gray-500">
                                <div class="loader mx-auto mb-2"></div>Loading timesheets...
                            </td></tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- Tickets Tab -->
        <div id="content-tickets" class="hidden">
            <!-- Tickets Stats -->
            <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-6">
                <div class="bg-white rounded-xl shadow p-4">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-sm text-gray-500">Pending Verification</p>
                            <p id="stat-tickets-pending" class="text-2xl font-bold text-yellow-600">-</p>
                        </div>
                        <div class="bg-yellow-100 p-3 rounded-full">
                            <i class="fas fa-hourglass-half text-yellow-600"></i>
                        </div>
                    </div>
                </div>
                <div class="bg-white rounded-xl shadow p-4">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-sm text-gray-500">Verified</p>
                            <p id="stat-tickets-verified" class="text-2xl font-bold text-green-600">-</p>
                        </div>
                        <div class="bg-green-100 p-3 rounded-full">
                            <i class="fas fa-check-circle text-green-600"></i>
                        </div>
                    </div>
                </div>
                <div class="bg-white rounded-xl shadow p-4">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-sm text-gray-500">Expired</p>
                            <p id="stat-tickets-expired" class="text-2xl font-bold text-red-600">-</p>
                        </div>
                        <div class="bg-red-100 p-3 rounded-full">
                            <i class="fas fa-exclamation-circle text-red-600"></i>
                        </div>
                    </div>
                </div>
                <div class="bg-white rounded-xl shadow p-4">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-sm text-gray-500">Total Tickets</p>
                            <p id="stat-tickets-total" class="text-2xl font-bold text-blue-600">-</p>
                        </div>
                        <div class="bg-blue-100 p-3 rounded-full">
                            <i class="fas fa-id-card text-blue-600"></i>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Tickets Filter -->
            <div class="bg-white rounded-xl shadow p-4 mb-6">
                <div class="flex flex-wrap gap-4 items-center">
                    <div>
                        <label class="block text-sm text-gray-500 mb-1">Status</label>
                        <select id="filter-ticket-status" onchange="loadTickets()" class="border rounded-lg px-3 py-2">
                            <option value="">All</option>
                            <option value="pending" selected>Pending</option>
                            <option value="verified">Verified</option>
                            <option value="expired">Expired</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm text-gray-500 mb-1">Worker</label>
                        <select id="filter-ticket-worker" onchange="loadTickets()" class="border rounded-lg px-3 py-2">
                            <option value="">All Workers</option>
                        </select>
                    </div>
                </div>
            </div>

            <!-- Tickets Grid -->
            <div id="tickets-grid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                <div class="bg-white rounded-xl shadow p-8 text-center text-gray-500 col-span-full">
                    <div class="loader mx-auto mb-2"></div>Loading tickets...
                </div>
            </div>
        </div>

        <!-- Inductions Tab -->
        <div id="content-inductions" class="hidden">
            <!-- Inductions Stats -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6">
                <div class="bg-white rounded-xl shadow p-4">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-sm text-gray-500">Incomplete</p>
                            <p id="stat-inductions-incomplete" class="text-2xl font-bold text-yellow-600">-</p>
                        </div>
                        <div class="bg-yellow-100 p-3 rounded-full">
                            <i class="fas fa-hourglass-half text-yellow-600"></i>
                        </div>
                    </div>
                </div>
                <div class="bg-white rounded-xl shadow p-4">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-sm text-gray-500">Complete</p>
                            <p id="stat-inductions-complete" class="text-2xl font-bold text-green-600">-</p>
                        </div>
                        <div class="bg-green-100 p-3 rounded-full">
                            <i class="fas fa-check-circle text-green-600"></i>
                        </div>
                    </div>
                </div>
                <div class="bg-white rounded-xl shadow p-4">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-sm text-gray-500">Total Workers</p>
                            <p id="stat-inductions-total" class="text-2xl font-bold text-blue-600">-</p>
                        </div>
                        <div class="bg-blue-100 p-3 rounded-full">
                            <i class="fas fa-users text-blue-600"></i>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Inductions Table -->
            <div class="bg-white rounded-xl shadow overflow-hidden">
                <div class="p-4 border-b">
                    <h2 class="text-lg font-semibold">Worker Induction Status</h2>
                </div>
                <div class="overflow-x-auto">
                    <table class="w-full">
                        <thead class="bg-gray-50">
                            <tr>
                                <th class="px-4 py-3 text-left text-sm font-medium text-gray-500">Worker</th>
                                <th class="px-4 py-3 text-left text-sm font-medium text-gray-500">Documents Signed</th>
                                <th class="px-4 py-3 text-left text-sm font-medium text-gray-500">Status</th>
                                <th class="px-4 py-3 text-left text-sm font-medium text-gray-500">Actions</th>
                            </tr>
                        </thead>
                        <tbody id="inductions-table" class="divide-y divide-gray-100">
                            <tr><td colspan="4" class="px-4 py-8 text-center text-gray-500">
                                <div class="loader mx-auto mb-2"></div>Loading inductions...
                            </td></tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- Workers Tab -->
        <div id="content-workers" class="hidden">
            <div class="bg-white rounded-xl shadow overflow-hidden">
                <div class="p-4 border-b flex justify-between items-center">
                    <h2 class="text-lg font-semibold">Workers Directory</h2>
                    <button onclick="openAddWorkerModal()" class="bg-blue-900 text-white px-4 py-2 rounded-lg hover:bg-blue-800">
                        <i class="fas fa-plus mr-2"></i>Add Worker
                    </button>
                </div>
                <div class="overflow-x-auto">
                    <table class="w-full">
                        <thead class="bg-gray-50">
                            <tr>
                                <th class="px-4 py-3 text-left text-sm font-medium text-gray-500">Name</th>
                                <th class="px-4 py-3 text-left text-sm font-medium text-gray-500">Email</th>
                                <th class="px-4 py-3 text-left text-sm font-medium text-gray-500">Phone</th>
                                <th class="px-4 py-3 text-left text-sm font-medium text-gray-500">Type</th>
                                <th class="px-4 py-3 text-left text-sm font-medium text-gray-500">Emergency Contact</th>
                                <th class="px-4 py-3 text-left text-sm font-medium text-gray-500">Status</th>
                                <th class="px-4 py-3 text-left text-sm font-medium text-gray-500">Actions</th>
                            </tr>
                        </thead>
                        <tbody id="workers-table" class="divide-y divide-gray-100">
                            <tr><td colspan="7" class="px-4 py-8 text-center text-gray-500">
                                <div class="loader mx-auto mb-2"></div>Loading workers...
                            </td></tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- Clients Tab -->
        <div id="content-clients" class="hidden">
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                <!-- Clients -->
                <div class="bg-white rounded-xl shadow overflow-hidden">
                    <div class="p-4 border-b flex justify-between items-center">
                        <h2 class="text-lg font-semibold">Clients</h2>
                        <button onclick="openAddClientModal()" class="bg-blue-900 text-white px-4 py-2 rounded-lg hover:bg-blue-800">
                            <i class="fas fa-plus mr-2"></i>Add Client
                        </button>
                    </div>
                    <div id="clients-list" class="divide-y divide-gray-100 max-h-96 overflow-y-auto">
                        <div class="px-4 py-8 text-center text-gray-500">
                            <div class="loader mx-auto mb-2"></div>Loading clients...
                        </div>
                    </div>
                </div>

                <!-- Job Sites -->
                <div class="bg-white rounded-xl shadow overflow-hidden">
                    <div class="p-4 border-b flex justify-between items-center">
                        <h2 class="text-lg font-semibold">Job Sites</h2>
                        <button onclick="openAddJobSiteModal()" class="bg-blue-900 text-white px-4 py-2 rounded-lg hover:bg-blue-800">
                            <i class="fas fa-plus mr-2"></i>Add Job Site
                        </button>
                    </div>
                    <div id="jobsites-list" class="divide-y divide-gray-100 max-h-96 overflow-y-auto">
                        <div class="px-4 py-8 text-center text-gray-500">
                            <div class="loader mx-auto mb-2"></div>Loading job sites...
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Notifications Tab -->
        <div id="content-notifications" class="hidden">
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                <!-- SMS Settings -->
                <div class="bg-white rounded-xl shadow overflow-hidden">
                    <div class="p-4 border-b">
                        <h2 class="text-lg font-semibold flex items-center gap-2">
                            <i class="fas fa-sms text-blue-600"></i>
                            SMS Reminder Settings
                        </h2>
                    </div>
                    <div class="p-6 space-y-6">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="font-medium">SMS Notifications</p>
                                <p class="text-sm text-gray-500">Enable/disable all SMS notifications</p>
                            </div>
                            <div class="flex items-center gap-2">
                                <button type="button" id="sms-enabled" onclick="toggleSwitch('sms-enabled')" class="toggle-switch" style="display:inline-block;width:44px;height:24px;background:#D1D5DB;border-radius:12px;border:none;position:relative;cursor:pointer;">
                                    <span class="toggle-slider" style="position:absolute;top:2px;left:2px;width:20px;height:20px;background:white;border-radius:50%;box-shadow:0 1px 3px rgba(0,0,0,0.3);transition:left 0.2s;"></span>
                                </button>
                                <span id="sms-enabled-label" class="text-sm font-medium text-red-600">OFF</span>
                            </div>
                        </div>
                        
                        <div class="border-t pt-4">
                            <div class="flex items-center justify-between mb-4">
                                <div>
                                    <p class="font-medium">Clock-In Reminder</p>
                                    <p class="text-sm text-gray-500">Remind workers who haven't clocked in</p>
                                </div>
                                <div class="flex items-center gap-2">
                                    <button type="button" id="clock-in-enabled" onclick="toggleSwitch('clock-in-enabled')" class="toggle-switch" style="display:inline-block;width:44px;height:24px;background:#D1D5DB;border-radius:12px;border:none;position:relative;cursor:pointer;">
                                        <span class="toggle-slider" style="position:absolute;top:2px;left:2px;width:20px;height:20px;background:white;border-radius:50%;box-shadow:0 1px 3px rgba(0,0,0,0.3);transition:left 0.2s;"></span>
                                    </button>
                                    <span id="clock-in-enabled-label" class="text-sm font-medium text-red-600">OFF</span>
                                </div>
                            </div>
                            <div class="flex items-center gap-2">
                                <label class="text-sm text-gray-500">Send at:</label>
                                <input type="time" id="clock-in-time" value="07:00" class="border rounded-lg px-3 py-2">
                            </div>
                        </div>
                        
                        <div class="border-t pt-4">
                            <div class="flex items-center justify-between mb-4">
                                <div>
                                    <p class="font-medium">Clock-Out Reminder</p>
                                    <p class="text-sm text-gray-500">Remind workers who haven't clocked out</p>
                                </div>
                                <div class="flex items-center gap-2">
                                    <button type="button" id="clock-out-enabled" onclick="toggleSwitch('clock-out-enabled')" class="toggle-switch" style="display:inline-block;width:44px;height:24px;background:#D1D5DB;border-radius:12px;border:none;position:relative;cursor:pointer;">
                                        <span class="toggle-slider" style="position:absolute;top:2px;left:2px;width:20px;height:20px;background:white;border-radius:50%;box-shadow:0 1px 3px rgba(0,0,0,0.3);transition:left 0.2s;"></span>
                                    </button>
                                    <span id="clock-out-enabled-label" class="text-sm font-medium text-red-600">OFF</span>
                                </div>
                            </div>
                            <div class="flex items-center gap-2">
                                <label class="text-sm text-gray-500">Send at:</label>
                                <input type="time" id="clock-out-time" value="17:00" class="border rounded-lg px-3 py-2">
                            </div>
                        </div>
                        
                        <div class="pt-4 border-t">
                            <button onclick="saveNotificationSettings()" class="w-full bg-blue-900 text-white py-3 rounded-lg hover:bg-blue-800">
                                <i class="fas fa-save mr-2"></i>Save Settings
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Manual Send / Test -->
                <div class="bg-white rounded-xl shadow overflow-hidden">
                    <div class="p-4 border-b">
                        <h2 class="text-lg font-semibold flex items-center gap-2">
                            <i class="fas fa-paper-plane text-green-600"></i>
                            Send Reminders Now
                        </h2>
                    </div>
                    <div class="p-6 space-y-4">
                        <div class="bg-green-50 border border-green-200 rounded-lg p-4 mb-4">
                            <p class="text-sm text-green-800 font-medium mb-2">
                                <i class="fas fa-clock mr-2"></i>Automatic Reminders Active
                            </p>
                            <div id="scheduler-status" class="text-sm text-green-700">
                                Loading schedule...
                            </div>
                        </div>
                        
                        <div class="bg-yellow-50 border border-yellow-200 rounded-lg p-4">
                            <p class="text-sm text-yellow-800">
                                <i class="fas fa-info-circle mr-2"></i>
                                Use these buttons to manually trigger reminders immediately.
                            </p>
                        </div>
                        
                        <button onclick="sendClockInReminders()" class="w-full bg-green-600 text-white py-3 rounded-lg hover:bg-green-700 flex items-center justify-center gap-2">
                            <i class="fas fa-sign-in-alt"></i>
                            Send Clock-In Reminders Now
                        </button>
                        
                        <button onclick="sendClockOutReminders()" class="w-full bg-orange-600 text-white py-3 rounded-lg hover:bg-orange-700 flex items-center justify-center gap-2">
                            <i class="fas fa-sign-out-alt"></i>
                            Send Clock-Out Reminders Now
                        </button>
                        
                        <div class="border-t pt-4 mt-4">
                            <h3 class="font-medium mb-3">Send Custom SMS</h3>
                            
                            <!-- Worker Selection with Checkboxes -->
                            <div class="flex gap-2 mb-2">
                                <button onclick="selectAllWorkers()" class="flex-1 bg-blue-100 text-blue-700 py-2 px-3 rounded-lg hover:bg-blue-200 text-sm font-medium">
                                    <i class="fas fa-check-double mr-1"></i>Select All
                                </button>
                                <button onclick="deselectAllWorkers()" class="flex-1 bg-gray-100 text-gray-700 py-2 px-3 rounded-lg hover:bg-gray-200 text-sm font-medium">
                                    <i class="fas fa-times mr-1"></i>Deselect All
                                </button>
                            </div>
                            
                            <div id="worker-checkboxes" class="max-h-48 overflow-y-auto border rounded-lg p-2 mb-3 bg-gray-50">
                                <!-- Workers will be populated here -->
                                <p class="text-gray-500 text-sm">Loading workers...</p>
                            </div>
                            
                            <div id="selected-workers-count" class="text-sm text-blue-600 mb-2">0 workers selected</div>
                            
                            <textarea id="sms-message" rows="3" class="w-full border rounded-lg px-3 py-2 mb-3" placeholder="Enter your message..."></textarea>
                            <button onclick="sendSMSToSelected()" class="w-full bg-blue-600 text-white py-2 rounded-lg hover:bg-blue-700">
                                <i class="fas fa-sms mr-2"></i>Send SMS to Selected Workers
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Twilio Setup Info -->
                <div class="bg-white rounded-xl shadow overflow-hidden lg:col-span-2">
                    <div class="p-4 border-b">
                        <h2 class="text-lg font-semibold flex items-center gap-2">
                            <i class="fas fa-cog text-gray-600"></i>
                            Twilio Configuration
                        </h2>
                    </div>
                    <div class="p-6">
                        <p class="text-gray-600 mb-4">
                            SMS notifications are powered by Twilio. To enable SMS, set these environment variables on Railway:
                        </p>
                        <div class="bg-gray-100 rounded-lg p-4 font-mono text-sm space-y-2">
                            <p><span class="text-blue-600">TWILIO_ACCOUNT_SID</span>=your_account_sid</p>
                            <p><span class="text-blue-600">TWILIO_AUTH_TOKEN</span>=your_auth_token</p>
                            <p><span class="text-blue-600">TWILIO_PHONE_NUMBER</span>=+61xxxxxxxxx</p>
                        </div>
                        <p class="text-sm text-gray-500 mt-4">
                            <i class="fas fa-external-link-alt mr-1"></i>
                            <a href="https://www.twilio.com/console" target="_blank" class="text-blue-600 hover:underline">Get Twilio credentials</a>
                        </p>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- Timesheet Detail Modal -->
    <div id="timesheet-modal" class="modal">
        <div class="bg-white rounded-2xl shadow-xl max-w-4xl w-full mx-4 max-h-[90vh] overflow-y-auto">
            <div class="sticky top-0 bg-white border-b px-6 py-4 flex justify-between items-center">
                <div>
                    <h2 class="text-xl font-bold">Timesheet Details</h2>
                    <p id="modal-docket" class="text-gray-500">Docket #12345</p>
                </div>
                <button onclick="closeModal('timesheet-modal')" class="text-gray-400 hover:text-gray-600">
                    <i class="fas fa-times text-2xl"></i>
                </button>
            </div>
            <div id="modal-content" class="p-6">
                <!-- Content loaded dynamically -->
            </div>
            <div id="modal-actions" class="sticky bottom-0 bg-gray-50 border-t px-6 py-4 flex gap-4 justify-end">
                <!-- Actions loaded dynamically -->
            </div>
        </div>
    </div>

    <!-- Add Worker Modal -->
    <div id="add-worker-modal" class="modal">
        <div class="bg-white rounded-2xl shadow-xl max-w-lg w-full mx-4 max-h-[90vh] overflow-y-auto">
            <div class="sticky top-0 bg-white border-b px-6 py-4 flex justify-between items-center">
                <h2 class="text-xl font-bold">Add New Worker</h2>
                <button onclick="closeModal('add-worker-modal')" class="text-gray-400 hover:text-gray-600">
                    <i class="fas fa-times text-2xl"></i>
                </button>
            </div>
            <form id="add-worker-form" onsubmit="submitAddWorker(event)" class="p-6 space-y-4">
                <div class="grid grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm font-medium mb-1">First Name *</label>
                        <input type="text" name="first_name" required class="w-full border rounded-lg px-3 py-2">
                    </div>
                    <div>
                        <label class="block text-sm font-medium mb-1">Surname *</label>
                        <input type="text" name="surname" required class="w-full border rounded-lg px-3 py-2">
                    </div>
                </div>
                <div>
                    <label class="block text-sm font-medium mb-1">Email *</label>
                    <input type="email" name="email" required class="w-full border rounded-lg px-3 py-2">
                </div>
                <div>
                    <label class="block text-sm font-medium mb-1">Phone</label>
                    <input type="tel" name="phone" class="w-full border rounded-lg px-3 py-2">
                </div>
                <div>
                    <label class="block text-sm font-medium mb-1">Employment Type</label>
                    <select name="employment_type" class="w-full border rounded-lg px-3 py-2">
                        <option value="casual">Casual</option>
                        <option value="full_time">Full Time</option>
                        <option value="part_time">Part Time</option>
                    </select>
                </div>
                <div class="pt-4 border-t flex gap-4 justify-end">
                    <button type="button" onclick="closeModal('add-worker-modal')" class="px-4 py-2 border rounded-lg hover:bg-gray-50">Cancel</button>
                    <button type="submit" class="px-4 py-2 bg-blue-900 text-white rounded-lg hover:bg-blue-800">Add Worker</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Add Client Modal -->
    <div id="add-client-modal" class="modal">
        <div class="bg-white rounded-2xl shadow-xl max-w-lg w-full mx-4">
            <div class="border-b px-6 py-4 flex justify-between items-center">
                <h2 class="text-xl font-bold">Add New Client</h2>
                <button onclick="closeModal('add-client-modal')" class="text-gray-400 hover:text-gray-600">
                    <i class="fas fa-times text-2xl"></i>
                </button>
            </div>
            <form id="add-client-form" onsubmit="submitAddClient(event)" class="p-6 space-y-4">
                <div>
                    <label class="block text-sm font-medium mb-1">Company Name *</label>
                    <input type="text" name="name" required class="w-full border rounded-lg px-3 py-2">
                </div>
                <div>
                    <label class="block text-sm font-medium mb-1">Contact Name</label>
                    <input type="text" name="contact_name" class="w-full border rounded-lg px-3 py-2">
                </div>
                <div>
                    <label class="block text-sm font-medium mb-1">Contact Email</label>
                    <input type="email" name="contact_email" class="w-full border rounded-lg px-3 py-2">
                </div>
                <div>
                    <label class="block text-sm font-medium mb-1">Contact Phone</label>
                    <input type="tel" name="contact_phone" class="w-full border rounded-lg px-3 py-2">
                </div>
                <div>
                    <label class="block text-sm font-medium mb-1">Address</label>
                    <textarea name="address" rows="2" class="w-full border rounded-lg px-3 py-2"></textarea>
                </div>
                <div class="pt-4 border-t flex gap-4 justify-end">
                    <button type="button" onclick="closeModal('add-client-modal')" class="px-4 py-2 border rounded-lg hover:bg-gray-50">Cancel</button>
                    <button type="submit" class="px-4 py-2 bg-blue-900 text-white rounded-lg hover:bg-blue-800">Add Client</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Add Job Site Modal -->
    <div id="add-jobsite-modal" class="modal">
        <div class="bg-white rounded-2xl shadow-xl max-w-lg w-full mx-4">
            <div class="border-b px-6 py-4 flex justify-between items-center">
                <h2 class="text-xl font-bold">Add New Job Site</h2>
                <button onclick="closeModal('add-jobsite-modal')" class="text-gray-400 hover:text-gray-600">
                    <i class="fas fa-times text-2xl"></i>
                </button>
            </div>
            <form id="add-jobsite-form" onsubmit="submitAddJobSite(event)" class="p-6 space-y-4">
                <div>
                    <label class="block text-sm font-medium mb-1">Site Name *</label>
                    <input type="text" name="name" required class="w-full border rounded-lg px-3 py-2">
                </div>
                <div>
                    <label class="block text-sm font-medium mb-1">Client *</label>
                    <select name="client_id" id="jobsite-client-select" required class="w-full border rounded-lg px-3 py-2">
                        <option value="">Select Client</option>
                    </select>
                </div>
                <div>
                    <label class="block text-sm font-medium mb-1">Address *</label>
                    <textarea name="address" required rows="2" class="w-full border rounded-lg px-3 py-2"></textarea>
                </div>
                <div>
                    <label class="block text-sm font-medium mb-1">Site Contact Name</label>
                    <input type="text" name="contact_name" class="w-full border rounded-lg px-3 py-2">
                </div>
                <div>
                    <label class="block text-sm font-medium mb-1">Site Contact Phone</label>
                    <input type="tel" name="contact_phone" class="w-full border rounded-lg px-3 py-2">
                </div>
                <div class="pt-4 border-t flex gap-4 justify-end">
                    <button type="button" onclick="closeModal('add-jobsite-modal')" class="px-4 py-2 border rounded-lg hover:bg-gray-50">Cancel</button>
                    <button type="submit" class="px-4 py-2 bg-blue-900 text-white rounded-lg hover:bg-blue-800">Add Job Site</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Ticket Detail Modal -->
    <div id="ticket-modal" class="modal">
        <div class="bg-white rounded-2xl shadow-xl max-w-2xl w-full mx-4 max-h-[90vh] overflow-y-auto">
            <div class="sticky top-0 bg-white border-b px-6 py-4 flex justify-between items-center">
                <div>
                    <h2 class="text-xl font-bold" id="ticket-modal-title">Ticket Details</h2>
                    <p id="ticket-modal-worker" class="text-gray-500">Worker Name</p>
                </div>
                <button onclick="closeModal('ticket-modal')" class="text-gray-400 hover:text-gray-600">
                    <i class="fas fa-times text-2xl"></i>
                </button>
            </div>
            <div id="ticket-modal-content" class="p-6">
                <!-- Content loaded dynamically -->
            </div>
            <div id="ticket-modal-actions" class="sticky bottom-0 bg-gray-50 border-t px-6 py-4 flex gap-4 justify-end">
                <!-- Actions loaded dynamically -->
            </div>
        </div>
    </div>

    <script>
        const API_BASE = '/api';
        let allTimesheets = [];
        let allWorkers = [];
        let allClients = [];
        let allJobSites = [];
        let allTickets = [];
        let allInductions = [];

        // Initialize
        document.addEventListener('DOMContentLoaded', () => {
            refreshData();
        });

        async function refreshData() {
            document.getElementById('lastUpdated').textContent = 'Updating...';
            await Promise.all([
                loadTimesheets(),
                loadWorkers(),
                loadClients(),
                loadJobSites(),
                loadTickets(),
                loadInductions(),
                loadNotificationSettings()
            ]);
            document.getElementById('lastUpdated').textContent = `Updated ${new Date().toLocaleTimeString()}`;
        }

        function switchTab(tab) {
            // Update tab buttons
            document.querySelectorAll('[id^="tab-"]').forEach(btn => {
                btn.classList.remove('tab-active');
                btn.classList.add('text-gray-500');
            });
            document.getElementById(`tab-${tab}`).classList.add('tab-active');
            document.getElementById(`tab-${tab}`).classList.remove('text-gray-500');

            // Update content
            document.querySelectorAll('[id^="content-"]').forEach(content => {
                content.classList.add('hidden');
            });
            document.getElementById(`content-${tab}`).classList.remove('hidden');
        }

        // ==================== TIMESHEETS ====================

        async function loadTimesheets() {
            const status = document.getElementById('filter-status').value;
            const workerId = document.getElementById('filter-worker').value;
            
            try {
                let url = `${API_BASE}/timesheets/admin/all`;
                const params = new URLSearchParams();
                if (status) params.append('status', status);
                if (workerId) params.append('worker_id', workerId);
                if (params.toString()) url += `?${params.toString()}`;

                const response = await fetch(url);
                const data = await response.json();
                allTimesheets = data.timesheets || [];
                renderTimesheets();
                updateStats();
            } catch (error) {
                console.error('Error loading timesheets:', error);
                document.getElementById('timesheets-table').innerHTML = 
                    `<tr><td colspan="7" class="px-4 py-8 text-center text-red-500">Error loading timesheets</td></tr>`;
            }
        }

        function renderTimesheets() {
            const tbody = document.getElementById('timesheets-table');
            
            if (allTimesheets.length === 0) {
                tbody.innerHTML = `<tr><td colspan="7" class="px-4 py-8 text-center text-gray-500">No timesheets found</td></tr>`;
                return;
            }

            tbody.innerHTML = allTimesheets.map(ts => `
                <tr class="hover:bg-gray-50">
                    <td class="px-4 py-3">
                        <span class="font-mono text-sm font-medium">#${ts.docket_number}</span>
                    </td>
                    <td class="px-4 py-3">
                        <div class="font-medium">${ts.worker_name || 'Unknown'}</div>
                    </td>
                    <td class="px-4 py-3">
                        <div class="text-sm">${formatDate(ts.week_starting)} - ${formatDate(ts.week_ending)}</div>
                    </td>
                    <td class="px-4 py-3">
                        <div class="text-sm">${ts.client_name || '-'}</div>
                    </td>
                    <td class="px-4 py-3">
                        <div class="font-medium">${(ts.total_hours || 0).toFixed(1)}h</div>
                        <div class="text-xs text-gray-500">${(ts.total_overtime_hours || 0).toFixed(1)}h OT</div>
                    </td>
                    <td class="px-4 py-3">
                        <span class="px-2 py-1 rounded-full text-xs font-medium status-${ts.status}">
                            ${ts.status.charAt(0).toUpperCase() + ts.status.slice(1)}
                        </span>
                    </td>
                    <td class="px-4 py-3">
                        <button onclick="viewTimesheet(${ts.id})" class="text-blue-600 hover:text-blue-800 mr-2" title="View">
                            <i class="fas fa-eye"></i>
                        </button>
                        <button onclick="deleteTimesheet(${ts.id}, '${ts.docket_number}')" class="text-red-600 hover:text-red-800" title="Delete">
                            <i class="fas fa-trash"></i>
                        </button>
                    </td>
                </tr>
            `).join('');
        }

        function updateStats() {
            const pending = allTimesheets.filter(ts => ts.status === 'submitted').length;
            const approved = allTimesheets.filter(ts => ts.status === 'approved').length;
            const totalHours = allTimesheets.reduce((sum, ts) => sum + (ts.total_hours || 0), 0);
            
            document.getElementById('stat-pending').textContent = pending;
            document.getElementById('stat-approved').textContent = approved;
            document.getElementById('stat-hours').textContent = totalHours.toFixed(1);
            document.getElementById('stat-workers').textContent = allWorkers.length;
        }

        async function viewTimesheet(id) {
            try {
                const response = await fetch(`${API_BASE}/timesheets/${id}`);
                const ts = await response.json();
                
                document.getElementById('modal-docket').textContent = `Docket #${ts.docket_number}`;
                
                const entriesHtml = (ts.entries || []).map(entry => `
                    <div class="border rounded-lg p-4 mb-3">
                        <div class="flex justify-between items-start mb-2">
                            <div>
                                <span class="font-medium">${entry.day_of_week}</span>
                                <span class="text-gray-500 text-sm ml-2">${formatDate(entry.entry_date)}</span>
                            </div>
                            <span class="px-2 py-1 rounded text-xs font-medium status-${entry.entry_status || 'draft'}">
                                ${(entry.entry_status || 'draft').charAt(0).toUpperCase() + (entry.entry_status || 'draft').slice(1)}
                            </span>
                        </div>
                        <div class="grid grid-cols-2 md:grid-cols-4 gap-4 text-sm">
                            <div>
                                <p class="text-gray-500">Time</p>
                                <p>${formatTime(entry.clock_in_time)} - ${formatTime(entry.clock_out_time)}</p>
                            </div>
                            <div>
                                <p class="text-gray-500">Hours</p>
                                <p>${(entry.total_hours || 0).toFixed(2)}h (${(entry.overtime_hours || 0).toFixed(2)}h OT)</p>
                            </div>
                            <div>
                                <p class="text-gray-500">Role</p>
                                <p>${entry.worked_as || '-'}</p>
                            </div>
                            <div>
                                <p class="text-gray-500">Location</p>
                                <p class="truncate" title="${entry.clock_in_address || '-'}">${entry.clock_in_address || '-'}</p>
                            </div>
                        </div>
                        ${entry.supervisor_name ? `
                            <div class="mt-3 pt-3 border-t">
                                <p class="text-sm text-gray-500">Supervisor: ${entry.supervisor_name} (${entry.supervisor_contact || '-'})</p>
                                ${entry.supervisor_signature ? `
                                    <img src="${entry.supervisor_signature}" alt="Signature" class="signature-img mt-2">
                                ` : ''}
                            </div>
                        ` : ''}
                        ${entry.comments ? `
                            <div class="mt-2 text-sm text-gray-600">
                                <i class="fas fa-comment-alt mr-1"></i> ${entry.comments}
                            </div>
                        ` : ''}
                    </div>
                `).join('');

                document.getElementById('modal-content').innerHTML = `
                    <div class="mb-6">
                        <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-4">
                            <div>
                                <p class="text-sm text-gray-500">Worker</p>
                                <p class="font-medium">${ts.worker_name || 'Unknown'}</p>
                            </div>
                            <div>
                                <p class="text-sm text-gray-500">Client</p>
                                <p class="font-medium">${ts.client_name || '-'}</p>
                            </div>
                            <div>
                                <p class="text-sm text-gray-500">Total Hours</p>
                                <p class="font-medium">${(ts.total_hours || 0).toFixed(2)}h</p>
                            </div>
                            <div>
                                <p class="text-sm text-gray-500">Overtime</p>
                                <p class="font-medium">${(ts.total_overtime_hours || 0).toFixed(2)}h</p>
                            </div>
                        </div>
                        ${ts.supervisor_signature ? `
                            <div class="bg-gray-50 rounded-lg p-4 mb-4">
                                <p class="text-sm text-gray-500 mb-2">Supervisor Approval</p>
                                <p class="font-medium">${ts.supervisor_name || '-'} | ${ts.supervisor_contact || '-'}</p>
                                <img src="${ts.supervisor_signature}" alt="Signature" class="signature-img mt-2">
                            </div>
                        ` : ''}
                    </div>
                    <h3 class="font-semibold mb-3">Daily Entries</h3>
                    ${entriesHtml || '<p class="text-gray-500">No entries</p>'}
                `;

                // Show appropriate actions based on status
                let actionsHtml = '';
                if (ts.status === 'submitted') {
                    actionsHtml = `
                        <button onclick="rejectTimesheet(${ts.id})" class="px-4 py-2 border border-red-500 text-red-500 rounded-lg hover:bg-red-50">
                            <i class="fas fa-times mr-2"></i>Reject
                        </button>
                        <button onclick="approveTimesheet(${ts.id})" class="px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700">
                            <i class="fas fa-check mr-2"></i>Approve
                        </button>
                    `;
                } else if (ts.status === 'approved') {
                    actionsHtml = `<span class="text-green-600"><i class="fas fa-check-circle mr-2"></i>Approved</span>`;
                } else if (ts.status === 'rejected') {
                    actionsHtml = `<span class="text-red-600"><i class="fas fa-times-circle mr-2"></i>Rejected</span>`;
                }
                document.getElementById('modal-actions').innerHTML = actionsHtml;

                openModal('timesheet-modal');
            } catch (error) {
                console.error('Error loading timesheet:', error);
                alert('Error loading timesheet details');
            }
        }

        async function approveTimesheet(id) {
            if (!confirm('Approve this timesheet?')) return;
            
            try {
                const response = await fetch(`${API_BASE}/timesheets/${id}/approve`, {
                    method: 'POST'
                });
                if (response.ok) {
                    closeModal('timesheet-modal');
                    await loadTimesheets();
                    alert('Timesheet approved!');
                } else {
                    const data = await response.json();
                    alert(data.detail || 'Error approving timesheet');
                }
            } catch (error) {
                console.error('Error:', error);
                alert('Error approving timesheet');
            }
        }

        async function rejectTimesheet(id) {
            const reason = prompt('Reason for rejection (optional):');
            if (reason === null) return;
            
            try {
                const response = await fetch(`${API_BASE}/timesheets/${id}/reject`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ reason })
                });
                if (response.ok) {
                    closeModal('timesheet-modal');
                    await loadTimesheets();
                    alert('Timesheet rejected');
                } else {
                    const data = await response.json();
                    alert(data.detail || 'Error rejecting timesheet');
                }
            } catch (error) {
                console.error('Error:', error);
                alert('Error rejecting timesheet');
            }
        }

        async function deleteTimesheet(id, docketNumber) {
            if (!confirm(`Are you sure you want to DELETE timesheet #${docketNumber}?\n\nThis action cannot be undone!`)) return;
            
            try {
                const response = await fetch(`${API_BASE}/timesheets/${id}`, {
                    method: 'DELETE'
                });
                if (response.ok) {
                    await loadTimesheets();
                    alert('Timesheet deleted');
                } else {
                    const data = await response.json();
                    alert(data.detail || 'Error deleting timesheet');
                }
            } catch (error) {
                console.error('Error:', error);
                alert('Error deleting timesheet');
            }
        }

        // ==================== WORKERS ====================

        async function loadWorkers() {
            try {
                const response = await fetch(`${API_BASE}/users/admin/workers`);
                const data = await response.json();
                allWorkers = data.workers || [];
                renderWorkers();
                populateWorkerFilter();
                // Also populate SMS worker checkboxes
                populateSMSWorkerSelect();
            } catch (error) {
                console.error('Error loading workers:', error);
            }
        }

        function renderWorkers() {
            const tbody = document.getElementById('workers-table');
            
            if (allWorkers.length === 0) {
                tbody.innerHTML = `<tr><td colspan="7" class="px-4 py-8 text-center text-gray-500">No workers found</td></tr>`;
                return;
            }

            tbody.innerHTML = allWorkers.map(w => `
                <tr class="hover:bg-gray-50">
                    <td class="px-4 py-3">
                        <div class="font-medium">${w.first_name} ${w.surname}</div>
                    </td>
                    <td class="px-4 py-3">${w.email}</td>
                    <td class="px-4 py-3">${w.phone || '-'}</td>
                    <td class="px-4 py-3">
                        <span class="capitalize">${(w.employment_type || 'casual').replace('_', ' ')}</span>
                    </td>
                    <td class="px-4 py-3">
                        ${w.emergency_contact_name ? `
                            <div class="text-sm">${w.emergency_contact_name}</div>
                            <div class="text-xs text-gray-500">${w.emergency_contact_phone || ''}</div>
                        ` : '<span class="text-yellow-600 text-sm">Not set</span>'}
                    </td>
                    <td class="px-4 py-3">
                        <span class="px-2 py-1 rounded-full text-xs font-medium ${w.is_active ? 'bg-green-100 text-green-700' : 'bg-red-100 text-red-700'}">
                            ${w.is_active ? 'Active' : 'Inactive'}
                        </span>
                    </td>
                    <td class="px-4 py-3">
                        <button onclick="viewWorker(${w.id})" class="text-blue-600 hover:text-blue-800 mr-2" title="View">
                            <i class="fas fa-eye"></i>
                        </button>
                        ${w.is_active ? `
                            <button onclick="deactivateWorker(${w.id})" class="text-red-600 hover:text-red-800" title="Deactivate">
                                <i class="fas fa-user-slash"></i>
                            </button>
                        ` : `
                            <button onclick="activateWorker(${w.id})" class="text-green-600 hover:text-green-800" title="Activate">
                                <i class="fas fa-user-check"></i>
                            </button>
                        `}
                    </td>
                </tr>
            `).join('');
        }

        function populateWorkerFilter() {
            const select = document.getElementById('filter-worker');
            select.innerHTML = '<option value="">All Workers</option>' +
                allWorkers.map(w => `<option value="${w.id}">${w.first_name} ${w.surname}</option>`).join('');
        }

        function openAddWorkerModal() {
            document.getElementById('add-worker-form').reset();
            openModal('add-worker-modal');
        }

        async function submitAddWorker(event) {
            event.preventDefault();
            const form = event.target;
            const formData = new FormData(form);
            const data = Object.fromEntries(formData.entries());

            try {
                const response = await fetch(`${API_BASE}/users/admin/workers`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(data)
                });

                const result = await response.json();
                if (response.ok) {
                    closeModal('add-worker-modal');
                    await loadWorkers();
                    alert(`Worker added! Temporary password: ${result.temp_password}\n\nShare this with the worker so they can log in.`);
                } else {
                    alert(result.detail || 'Error adding worker');
                }
            } catch (error) {
                console.error('Error:', error);
                alert('Error adding worker');
            }
        }

        async function viewWorker(id) {
            alert('Worker details view coming soon');
        }

        async function activateWorker(id) {
            if (!confirm('Activate this worker?')) return;
            try {
                await fetch(`${API_BASE}/users/admin/workers/${id}/activate`, { method: 'PATCH' });
                await loadWorkers();
            } catch (error) {
                alert('Error activating worker');
            }
        }

        async function deactivateWorker(id) {
            if (!confirm('Deactivate this worker?')) return;
            try {
                await fetch(`${API_BASE}/users/admin/workers/${id}/deactivate`, { method: 'PATCH' });
                await loadWorkers();
            } catch (error) {
                alert('Error deactivating worker');
            }
        }

        // ==================== CLIENTS ====================

        async function loadClients() {
            try {
                const response = await fetch(`${API_BASE}/clients/`);
                const data = await response.json();
                allClients = data.clients || [];
                renderClients();
                populateClientSelect();
            } catch (error) {
                console.error('Error loading clients:', error);
            }
        }

        function renderClients() {
            const container = document.getElementById('clients-list');
            
            if (allClients.length === 0) {
                container.innerHTML = `<div class="px-4 py-8 text-center text-gray-500">No clients yet</div>`;
                return;
            }

            container.innerHTML = allClients.map(c => `
                <div class="p-4 hover:bg-gray-50">
                    <div class="flex justify-between items-start">
                        <div>
                            <div class="font-medium">${c.name}</div>
                            ${c.contact_name ? `<div class="text-sm text-gray-500">${c.contact_name}</div>` : ''}
                            ${c.contact_email ? `<div class="text-sm text-gray-500">${c.contact_email}</div>` : ''}
                        </div>
                        <span class="px-2 py-1 rounded-full text-xs font-medium ${c.is_active ? 'bg-green-100 text-green-700' : 'bg-gray-100 text-gray-500'}">
                            ${c.is_active ? 'Active' : 'Inactive'}
                        </span>
                    </div>
                </div>
            `).join('');
        }

        function populateClientSelect() {
            const select = document.getElementById('jobsite-client-select');
            select.innerHTML = '<option value="">Select Client</option>' +
                allClients.map(c => `<option value="${c.id}">${c.name}</option>`).join('');
        }

        function openAddClientModal() {
            document.getElementById('add-client-form').reset();
            openModal('add-client-modal');
        }

        async function submitAddClient(event) {
            event.preventDefault();
            const form = event.target;
            const formData = new FormData(form);
            const data = Object.fromEntries(formData.entries());

            try {
                const response = await fetch(`${API_BASE}/clients/`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(data)
                });

                if (response.ok) {
                    closeModal('add-client-modal');
                    await loadClients();
                    alert('Client added!');
                } else {
                    const result = await response.json();
                    alert(result.detail || 'Error adding client');
                }
            } catch (error) {
                console.error('Error:', error);
                alert('Error adding client');
            }
        }

        // ==================== JOB SITES ====================

        async function loadJobSites() {
            try {
                const response = await fetch(`${API_BASE}/clients/job-sites/all`);
                const data = await response.json();
                allJobSites = data.job_sites || [];
                renderJobSites();
            } catch (error) {
                console.error('Error loading job sites:', error);
            }
        }

        function renderJobSites() {
            const container = document.getElementById('jobsites-list');
            
            if (allJobSites.length === 0) {
                container.innerHTML = `<div class="px-4 py-8 text-center text-gray-500">No job sites yet</div>`;
                return;
            }

            container.innerHTML = allJobSites.map(js => `
                <div class="p-4 hover:bg-gray-50">
                    <div class="flex justify-between items-start">
                        <div class="flex-1">
                            <div class="font-medium">${js.name}</div>
                            <div class="text-sm text-blue-600">${js.client_name || '-'}</div>
                            <div class="text-sm text-gray-500">${js.address}</div>
                        </div>
                        <div class="flex items-center gap-2">
                            <span class="px-2 py-1 rounded-full text-xs font-medium ${js.is_active ? 'bg-green-100 text-green-700' : 'bg-gray-100 text-gray-500'}">
                                ${js.is_active ? 'Active' : 'Inactive'}
                            </span>
                            <button onclick="deleteJobSite(${js.id}, '${js.name.replace(/'/g, "\\'")}')" class="text-red-600 hover:text-red-800 p-1" title="Delete">
                                <i class="fas fa-trash text-sm"></i>
                            </button>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        function openAddJobSiteModal() {
            document.getElementById('add-jobsite-form').reset();
            openModal('add-jobsite-modal');
        }

        async function submitAddJobSite(event) {
            event.preventDefault();
            const form = event.target;
            const formData = new FormData(form);
            const data = Object.fromEntries(formData.entries());
            data.client_id = parseInt(data.client_id);

            try {
                const response = await fetch(`${API_BASE}/jobsites/`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(data)
                });

                if (response.ok) {
                    closeModal('add-jobsite-modal');
                    await loadJobSites();
                    alert('Job site added!');
                } else {
                    const result = await response.json();
                    alert(result.detail || 'Error adding job site');
                }
            } catch (error) {
                console.error('Error:', error);
                alert('Error adding job site');
            }
        }

        async function deleteJobSite(id, name) {
            if (!confirm(`Are you sure you want to DELETE job site "${name}"?\n\nThis action cannot be undone!`)) return;
            
            try {
                const response = await fetch(`${API_BASE}/jobsites/${id}`, {
                    method: 'DELETE'
                });
                if (response.ok) {
                    await loadJobSites();
                    alert('Job site deleted');
                } else {
                    const data = await response.json();
                    alert(data.detail || 'Error deleting job site');
                }
            } catch (error) {
                console.error('Error:', error);
                alert('Error deleting job site');
            }
        }

        // ==================== TICKETS ====================

        async function loadTickets() {
            const status = document.getElementById('filter-ticket-status')?.value || '';
            const workerId = document.getElementById('filter-ticket-worker')?.value || '';
            
            try {
                let url = `${API_BASE}/tickets/admin/all`;
                const params = new URLSearchParams();
                if (status) params.append('status', status);
                if (workerId) params.append('worker_id', workerId);
                if (params.toString()) url += `?${params.toString()}`;

                const response = await fetch(url);
                const data = await response.json();
                allTickets = data.tickets || [];
                renderTickets();
                updateTicketStats();
                populateTicketWorkerFilter();
            } catch (error) {
                console.error('Error loading tickets:', error);
                document.getElementById('tickets-grid').innerHTML = 
                    `<div class="bg-white rounded-xl shadow p-8 text-center text-red-500 col-span-full">Error loading tickets</div>`;
            }
        }

        function renderTickets() {
            const grid = document.getElementById('tickets-grid');
            
            if (allTickets.length === 0) {
                grid.innerHTML = `<div class="bg-white rounded-xl shadow p-8 text-center text-gray-500 col-span-full">No tickets found</div>`;
                return;
            }

            grid.innerHTML = allTickets.map(t => `
                <div class="bg-white rounded-xl shadow p-4 hover:shadow-lg transition-shadow cursor-pointer" onclick="viewTicket(${t.id})">
                    <div class="flex justify-between items-start mb-3">
                        <div>
                            <h3 class="font-medium">${t.ticket_type_name || 'Unknown Type'}</h3>
                            <p class="text-sm text-gray-500">${t.user_name || 'Unknown Worker'}</p>
                        </div>
                        <span class="px-2 py-1 rounded-full text-xs font-medium ${getTicketStatusClass(t.status)}">
                            ${(t.status || 'pending').charAt(0).toUpperCase() + (t.status || 'pending').slice(1)}
                        </span>
                    </div>
                    <div class="text-sm text-gray-500 space-y-1">
                        ${t.ticket_number ? `<p><i class="fas fa-hashtag mr-1"></i>${t.ticket_number}</p>` : ''}
                        ${t.expiry_date ? `<p><i class="fas fa-calendar mr-1"></i>Expires: ${formatDate(t.expiry_date)}</p>` : ''}
                    </div>
                    ${t.front_image ? `
                        <div class="mt-3 bg-gray-100 rounded-lg p-2">
                            <img src="${t.front_image}" alt="Ticket" class="w-full h-24 object-contain rounded">
                        </div>
                    ` : ''}
                </div>
            `).join('');
        }

        function getTicketStatusClass(status) {
            switch(status) {
                case 'verified': return 'bg-green-100 text-green-700';
                case 'expired': return 'bg-red-100 text-red-700';
                case 'rejected': return 'bg-red-100 text-red-700';
                default: return 'bg-yellow-100 text-yellow-700';
            }
        }

        function updateTicketStats() {
            const pending = allTickets.filter(t => t.status === 'pending').length;
            const verified = allTickets.filter(t => t.status === 'verified').length;
            const expired = allTickets.filter(t => t.status === 'expired').length;
            
            document.getElementById('stat-tickets-pending').textContent = pending;
            document.getElementById('stat-tickets-verified').textContent = verified;
            document.getElementById('stat-tickets-expired').textContent = expired;
            document.getElementById('stat-tickets-total').textContent = allTickets.length;
        }

        function populateTicketWorkerFilter() {
            const select = document.getElementById('filter-ticket-worker');
            if (select && allWorkers.length > 0) {
                select.innerHTML = '<option value="">All Workers</option>' +
                    allWorkers.map(w => `<option value="${w.id}">${w.first_name} ${w.surname}</option>`).join('');
            }
        }

        async function viewTicket(id) {
            const ticket = allTickets.find(t => t.id === id);
            if (!ticket) return;

            document.getElementById('ticket-modal-title').textContent = ticket.ticket_type_name || 'Ticket Details';
            document.getElementById('ticket-modal-worker').textContent = ticket.user_name || 'Unknown Worker';

            document.getElementById('ticket-modal-content').innerHTML = `
                <div class="space-y-4">
                    <div class="grid grid-cols-2 gap-4">
                        <div>
                            <p class="text-sm text-gray-500">Ticket Number</p>
                            <p class="font-medium">${ticket.ticket_number || '-'}</p>
                        </div>
                        <div>
                            <p class="text-sm text-gray-500">Status</p>
                            <span class="px-2 py-1 rounded-full text-xs font-medium ${getTicketStatusClass(ticket.status)}">
                                ${(ticket.status || 'pending').charAt(0).toUpperCase() + (ticket.status || 'pending').slice(1)}
                            </span>
                        </div>
                        <div>
                            <p class="text-sm text-gray-500">Issue Date</p>
                            <p class="font-medium">${ticket.issue_date ? formatDate(ticket.issue_date) : '-'}</p>
                        </div>
                        <div>
                            <p class="text-sm text-gray-500">Expiry Date</p>
                            <p class="font-medium">${ticket.expiry_date ? formatDate(ticket.expiry_date) : '-'}</p>
                        </div>
                    </div>
                    
                    ${ticket.front_image || ticket.back_image ? `
                        <div class="border-t pt-4">
                            <p class="text-sm text-gray-500 mb-3">Ticket Images</p>
                            <div class="grid grid-cols-2 gap-4">
                                ${ticket.front_image ? `
                                    <div>
                                        <p class="text-xs text-gray-400 mb-2">Front</p>
                                        <img src="${ticket.front_image}" alt="Front" class="w-full rounded-lg border cursor-pointer" onclick="window.open('${ticket.front_image}', '_blank')">
                                    </div>
                                ` : ''}
                                ${ticket.back_image ? `
                                    <div>
                                        <p class="text-xs text-gray-400 mb-2">Back</p>
                                        <img src="${ticket.back_image}" alt="Back" class="w-full rounded-lg border cursor-pointer" onclick="window.open('${ticket.back_image}', '_blank')">
                                    </div>
                                ` : ''}
                            </div>
                        </div>
                    ` : ''}
                </div>
            `;

            // Actions based on status
            let actionsHtml = '';
            if (ticket.status === 'pending') {
                actionsHtml = `
                    <button onclick="rejectTicket(${ticket.id})" class="px-4 py-2 border border-red-500 text-red-500 rounded-lg hover:bg-red-50">
                        <i class="fas fa-times mr-2"></i>Reject
                    </button>
                    <button onclick="verifyTicket(${ticket.id})" class="px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700">
                        <i class="fas fa-check mr-2"></i>Verify
                    </button>
                `;
            } else if (ticket.status === 'verified') {
                actionsHtml = `<span class="text-green-600"><i class="fas fa-check-circle mr-2"></i>Verified</span>`;
            } else if (ticket.status === 'rejected') {
                actionsHtml = `<span class="text-red-600"><i class="fas fa-times-circle mr-2"></i>Rejected</span>`;
            }
            document.getElementById('ticket-modal-actions').innerHTML = actionsHtml;

            openModal('ticket-modal');
        }

        async function verifyTicket(id) {
            if (!confirm('Verify this ticket?')) return;
            
            try {
                const response = await fetch(`${API_BASE}/tickets/admin/${id}/verify`, { method: 'POST' });
                if (response.ok) {
                    closeModal('ticket-modal');
                    await loadTickets();
                    alert('Ticket verified!');
                } else {
                    const data = await response.json();
                    alert(data.detail || 'Error verifying ticket');
                }
            } catch (error) {
                console.error('Error:', error);
                alert('Error verifying ticket');
            }
        }

        async function rejectTicket(id) {
            const reason = prompt('Reason for rejection (optional):');
            if (reason === null) return;
            
            try {
                const response = await fetch(`${API_BASE}/tickets/admin/${id}/reject`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ reason })
                });
                if (response.ok) {
                    closeModal('ticket-modal');
                    await loadTickets();
                    alert('Ticket rejected');
                } else {
                    const data = await response.json();
                    alert(data.detail || 'Error rejecting ticket');
                }
            } catch (error) {
                console.error('Error:', error);
                alert('Error rejecting ticket');
            }
        }

        // ==================== INDUCTIONS ====================

        async function loadInductions() {
            try {
                const response = await fetch(`${API_BASE}/induction/admin/all-status`);
                const data = await response.json();
                allInductions = data.users || [];
                renderInductions();
                updateInductionStats();
            } catch (error) {
                console.error('Error loading inductions:', error);
                document.getElementById('inductions-table').innerHTML = 
                    `<tr><td colspan="4" class="px-4 py-8 text-center text-red-500">Error loading inductions</td></tr>`;
            }
        }

        function renderInductions() {
            const tbody = document.getElementById('inductions-table');
            
            if (allInductions.length === 0) {
                tbody.innerHTML = `<tr><td colspan="4" class="px-4 py-8 text-center text-gray-500">No induction data found</td></tr>`;
                return;
            }

            tbody.innerHTML = allInductions.map(w => `
                <tr class="hover:bg-gray-50">
                    <td class="px-4 py-3">
                        <div class="font-medium">${w.user_name}</div>
                        <div class="text-sm text-gray-500">${w.user_email}</div>
                    </td>
                    <td class="px-4 py-3">
                        <div class="flex items-center gap-2">
                            <div class="w-24 bg-gray-200 rounded-full h-2">
                                <div class="bg-blue-600 h-2 rounded-full" style="width: ${w.completion_percentage || 0}%"></div>
                            </div>
                            <span class="text-sm">${w.total_signed || 0}/${w.total_required || 0}</span>
                        </div>
                    </td>
                    <td class="px-4 py-3">
                        <span class="px-2 py-1 rounded-full text-xs font-medium ${w.is_complete ? 'bg-green-100 text-green-700' : 'bg-yellow-100 text-yellow-700'}">
                            ${w.is_complete ? 'Complete' : 'Incomplete'}
                        </span>
                    </td>
                    <td class="px-4 py-3">
                        <button onclick="viewInductionDetails(${w.user_id})" class="text-blue-600 hover:text-blue-800">
                            <i class="fas fa-eye"></i> View
                        </button>
                    </td>
                </tr>
            `).join('');
        }

        function updateInductionStats() {
            const incomplete = allInductions.filter(w => !w.is_complete).length;
            const complete = allInductions.filter(w => w.is_complete).length;
            
            document.getElementById('stat-inductions-incomplete').textContent = incomplete;
            document.getElementById('stat-inductions-complete').textContent = complete;
            document.getElementById('stat-inductions-total').textContent = allInductions.length;
        }

        async function viewInductionDetails(userId) {
            try {
                const response = await fetch(`${API_BASE}/induction/admin/user/${userId}/details`);
                const data = await response.json();
                
                const docsHtml = data.documents.map(doc => `
                    <div class="flex justify-between items-center p-3 border-b">
                        <div>
                            <p class="font-medium">${doc.title}</p>
                            <p class="text-sm text-gray-500">${doc.document_type}${doc.is_required ? ' (Required)' : ''}</p>
                        </div>
                        <span class="px-2 py-1 rounded-full text-xs font-medium ${doc.status === 'signed' ? 'bg-green-100 text-green-700' : 'bg-yellow-100 text-yellow-700'}">
                            ${doc.status === 'signed' ? 'Signed' : 'Pending'}
                        </span>
                    </div>
                `).join('');
                
                document.getElementById('ticket-modal-title').textContent = 'Induction Progress';
                document.getElementById('ticket-modal-worker').textContent = data.user.name;
                document.getElementById('ticket-modal-content').innerHTML = `
                    <div class="space-y-2">
                        ${docsHtml || '<p class="text-gray-500 text-center py-4">No documents</p>'}
                    </div>
                `;
                document.getElementById('ticket-modal-actions').innerHTML = '';
                openModal('ticket-modal');
            } catch (error) {
                console.error('Error:', error);
                alert('Error loading induction details');
            }
        }

        // ==================== NOTIFICATIONS ====================

        function toggleSwitch(id) {
            const el = document.getElementById(id);
            const slider = el.querySelector('.toggle-slider');
            const label = document.getElementById(id + '-label');
            const isActive = el.classList.contains('active');
            
            if (isActive) {
                el.classList.remove('active');
                el.style.background = '#D1D5DB';
                slider.style.left = '2px';
                if (label) {
                    label.textContent = 'OFF';
                    label.className = 'text-sm font-medium text-red-600';
                }
            } else {
                el.classList.add('active');
                el.style.background = '#2563EB';
                slider.style.left = '22px';
                if (label) {
                    label.textContent = 'ON';
                    label.className = 'text-sm font-medium text-green-600';
                }
            }
        }

        function setToggle(id, value) {
            const el = document.getElementById(id);
            const slider = el.querySelector('.toggle-slider');
            const label = document.getElementById(id + '-label');
            if (value) {
                el.classList.add('active');
                el.style.background = '#2563EB';
                slider.style.left = '22px';
                if (label) {
                    label.textContent = 'ON';
                    label.className = 'text-sm font-medium text-green-600';
                }
            } else {
                el.classList.remove('active');
                el.style.background = '#D1D5DB';
                slider.style.left = '2px';
                if (label) {
                    label.textContent = 'OFF';
                    label.className = 'text-sm font-medium text-red-600';
                }
            }
        }

        function getToggleValue(id) {
            return document.getElementById(id).classList.contains('active');
        }

        async function loadNotificationSettings() {
            try {
                const response = await fetch(`${API_BASE}/notifications/settings`);
                const data = await response.json();
                
                setToggle('sms-enabled', data.sms_enabled);
                setToggle('clock-in-enabled', data.clock_in_reminder_enabled);
                document.getElementById('clock-in-time').value = data.clock_in_reminder_time;
                setToggle('clock-out-enabled', data.clock_out_reminder_enabled);
                document.getElementById('clock-out-time').value = data.clock_out_reminder_time;
                
                // Load scheduler status
                loadSchedulerStatus();
            } catch (error) {
                console.error('Error loading notification settings:', error);
            }
        }
        
        async function loadSchedulerStatus() {
            try {
                const response = await fetch(`${API_BASE}/notifications/scheduler-status`);
                const data = await response.json();
                
                const statusDiv = document.getElementById('scheduler-status');
                if (data.running && data.jobs && data.jobs.length > 0) {
                    statusDiv.innerHTML = data.jobs.map(job => 
                        `<div class="flex justify-between items-center py-1">
                            <span>${job.name}:</span>
                            <span class="font-medium">${job.next_run_formatted}</span>
                        </div>`
                    ).join('');
                } else if (data.error) {
                    statusDiv.innerHTML = `<span class="text-yellow-600">Scheduler not running: ${data.error}</span>`;
                } else {
                    statusDiv.innerHTML = '<span class="text-yellow-600">No scheduled jobs</span>';
                }
            } catch (error) {
                console.error('Error loading scheduler status:', error);
                document.getElementById('scheduler-status').innerHTML = '<span class="text-red-600">Could not load schedule</span>';
            }
        }

        function populateSMSWorkerSelect() {
            const container = document.getElementById('worker-checkboxes');
            const workersWithPhone = allWorkers.filter(w => w.phone);
            
            if (container && workersWithPhone.length > 0) {
                container.innerHTML = workersWithPhone.map(w => `
                    <label class="flex items-center gap-2 p-2 hover:bg-white rounded cursor-pointer">
                        <input type="checkbox" class="worker-checkbox w-4 h-4 text-blue-600 rounded" data-worker-id="${w.id}" data-worker-name="${w.first_name} ${w.surname}">
                        <span class="flex-1">${w.first_name} ${w.surname}</span>
                        <span class="text-gray-500 text-sm">${w.phone}</span>
                    </label>
                `).join('');
                
                // Add change listener to update count
                container.querySelectorAll('.worker-checkbox').forEach(cb => {
                    cb.addEventListener('change', updateSelectedCount);
                });
            } else if (container) {
                container.innerHTML = '<p class="text-gray-500 text-sm p-2">No workers with phone numbers found</p>';
            }
            
            updateSelectedCount();
        }
        
        function updateSelectedCount() {
            const checkboxes = document.querySelectorAll('.worker-checkbox:checked');
            const countDiv = document.getElementById('selected-workers-count');
            countDiv.textContent = `${checkboxes.length} worker${checkboxes.length !== 1 ? 's' : ''} selected`;
        }
        
        function selectAllWorkers() {
            document.querySelectorAll('.worker-checkbox').forEach(cb => cb.checked = true);
            updateSelectedCount();
        }
        
        function deselectAllWorkers() {
            document.querySelectorAll('.worker-checkbox').forEach(cb => cb.checked = false);
            updateSelectedCount();
        }
        
        async function sendSMSToSelected() {
            const checkboxes = document.querySelectorAll('.worker-checkbox:checked');
            const message = document.getElementById('sms-message').value.trim();
            
            if (checkboxes.length === 0) {
                alert('Please select at least one worker');
                return;
            }
            if (!message) {
                alert('Please enter a message');
                return;
            }
            
            const workerNames = Array.from(checkboxes).map(cb => cb.dataset.workerName).slice(0, 3).join(', ');
            const moreText = checkboxes.length > 3 ? ` and ${checkboxes.length - 3} more` : '';
            
            if (!confirm(`Send SMS to ${checkboxes.length} worker(s)?\n\n${workerNames}${moreText}\n\nMessage: "${message.substring(0, 50)}${message.length > 50 ? '...' : ''}"`)) {
                return;
            }
            
            let sent = 0;
            let failed = 0;
            const errors = [];
            
            for (const cb of checkboxes) {
                const workerId = cb.dataset.workerId;
                try {
                    const response = await fetch(`${API_BASE}/notifications/send-sms`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ worker_id: parseInt(workerId), message })
                    });
                    
                    if (response.ok) {
                        sent++;
                    } else {
                        failed++;
                        const data = await response.json();
                        errors.push(`${cb.dataset.workerName}: ${data.detail || 'Failed'}`);
                    }
                } catch (error) {
                    failed++;
                    errors.push(`${cb.dataset.workerName}: ${error.message}`);
                }
            }
            
            let resultMsg = `SMS sent to ${sent} worker(s).`;
            if (failed > 0) {
                resultMsg += `\n${failed} failed.`;
                if (errors.length <= 5) {
                    resultMsg += '\n\nErrors:\n' + errors.join('\n');
                }
            }
            alert(resultMsg);
            
            if (sent > 0) {
                document.getElementById('sms-message').value = '';
                deselectAllWorkers();
            }
        }

        async function saveNotificationSettings() {
            const data = {
                sms_enabled: getToggleValue('sms-enabled'),
                clock_in_reminder_enabled: getToggleValue('clock-in-enabled'),
                clock_in_reminder_time: document.getElementById('clock-in-time').value,
                clock_out_reminder_enabled: getToggleValue('clock-out-enabled'),
                clock_out_reminder_time: document.getElementById('clock-out-time').value
            };

            try {
                const response = await fetch(`${API_BASE}/notifications/settings`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(data)
                });

                if (response.ok) {
                    alert('Notification settings saved!');
                } else {
                    const result = await response.json();
                    alert(result.detail || 'Error saving settings');
                }
            } catch (error) {
                console.error('Error:', error);
                alert('Error saving settings');
            }
        }

        async function sendClockInReminders() {
            if (!confirm('Send clock-in reminders to all workers who haven\'t clocked in today?')) return;
            
            try {
                const response = await fetch(`${API_BASE}/notifications/check-clock-in-reminders`, {
                    method: 'POST'
                });
                const data = await response.json();
                
                alert(`${data.message}\n\nSent: ${data.sent} SMS${data.errors ? `\nErrors: ${data.errors.length}` : ''}`);
            } catch (error) {
                console.error('Error:', error);
                alert('Error sending reminders');
            }
        }

        async function sendClockOutReminders() {
            if (!confirm('Send clock-out reminders to all workers who are still clocked in?')) return;
            
            try {
                const response = await fetch(`${API_BASE}/notifications/check-clock-out-reminders`, {
                    method: 'POST'
                });
                const data = await response.json();
                
                alert(`${data.message}\n\nSent: ${data.sent} SMS${data.errors ? `\nErrors: ${data.errors.length}` : ''}`);
            } catch (error) {
                console.error('Error:', error);
                alert('Error sending reminders');
            }
        }


        // ==================== UTILITIES ====================

        function openModal(id) {
            document.getElementById(id).classList.add('active');
        }

        function closeModal(id) {
            document.getElementById(id).classList.remove('active');
        }

        function formatDate(dateStr) {
            if (!dateStr) return '-';
            const date = new Date(dateStr);
            return date.toLocaleDateString('en-AU', { day: 'numeric', month: 'short' });
        }

        function formatTime(timeStr) {
            if (!timeStr) return '--:--';
            if (timeStr.includes('T')) {
                const date = new Date(timeStr);
                return date.toLocaleTimeString('en-AU', { hour: '2-digit', minute: '2-digit' });
            }
            return timeStr.substring(0, 5);
        }
    </script>
</body>
</html>
